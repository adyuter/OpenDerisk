(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[172,8453,3820],{3089:function(e,t,l){"use strict";l.d(t,{Z:function(){return o}});var n=l(87462),r=l(67294),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},i=l(84089),o=r.forwardRef(function(e,t){return r.createElement(i.Z,(0,n.Z)({},e,{ref:t,icon:a}))})},27496:function(e,t,l){"use strict";l.d(t,{Z:function(){return o}});var n=l(87462),r=l(67294),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2a15.99 15.99 0 00-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-.9 3.7-.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 .7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-.8 4.2-2.6 5-5 1.4-4.2-.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z"}}]},name:"send",theme:"outlined"},i=l(84089),o=r.forwardRef(function(e,t){return r.createElement(i.Z,(0,n.Z)({},e,{ref:t,icon:a}))})},94668:function(e,t,l){"use strict";l.d(t,{Z:function(){return o}});var n=l(87462),r=l(67294),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8zM872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"swap",theme:"outlined"},i=l(84089),o=r.forwardRef(function(e,t){return r.createElement(i.Z,(0,n.Z)({},e,{ref:t,icon:a}))})},45745:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/knowledge/chunk",function(){return l(26784)}])},50948:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var l in t)Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}(t,{noSSR:function(){return i},default:function(){return o}});let n=l(38754),r=(l(67294),n._(l(23900)));function a(e){return{default:(null==e?void 0:e.default)||e}}function i(e,t){return delete t.webpack,delete t.modules,e(t)}function o(e,t){let l=r.default,n={loading:e=>{let{error:t,isLoading:l,pastDelay:n}=e;return null}};e instanceof Promise?n.loader=()=>e:"function"==typeof e?n.loader=e:"object"==typeof e&&(n={...n,...e}),n={...n,...t};let o=n.loader;return(n.loadableGenerated&&(n={...n,...n.loadableGenerated},delete n.loadableGenerated),"boolean"!=typeof n.ssr||n.ssr)?l({...n,loader:()=>null!=o?o().then(a):Promise.resolve(a(()=>null))}):(delete n.webpack,delete n.modules,i(l,n))}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},2804:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"LoadableContext",{enumerable:!0,get:function(){return a}});let n=l(38754),r=n._(l(67294)),a=r.default.createContext(null)},23900:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return f}});let n=l(38754),r=n._(l(67294)),a=l(2804),i=[],o=[],s=!1;function c(e){let t=e(),l={loading:!0,loaded:null,error:null};return l.promise=t.then(e=>(l.loading=!1,l.loaded=e,e)).catch(e=>{throw l.loading=!1,l.error=e,e}),l}class u{promise(){return this._res.promise}retry(){this._clearTimeouts(),this._res=this._loadFn(this._opts.loader),this._state={pastDelay:!1,timedOut:!1};let{_res:e,_opts:t}=this;e.loading&&("number"==typeof t.delay&&(0===t.delay?this._state.pastDelay=!0:this._delay=setTimeout(()=>{this._update({pastDelay:!0})},t.delay)),"number"==typeof t.timeout&&(this._timeout=setTimeout(()=>{this._update({timedOut:!0})},t.timeout))),this._res.promise.then(()=>{this._update({}),this._clearTimeouts()}).catch(e=>{this._update({}),this._clearTimeouts()}),this._update({})}_update(e){this._state={...this._state,error:this._res.error,loaded:this._res.loaded,loading:this._res.loading,...e},this._callbacks.forEach(e=>e())}_clearTimeouts(){clearTimeout(this._delay),clearTimeout(this._timeout)}getCurrentValue(){return this._state}subscribe(e){return this._callbacks.add(e),()=>{this._callbacks.delete(e)}}constructor(e,t){this._loadFn=e,this._opts=t,this._callbacks=new Set,this._delay=null,this._timeout=null,this.retry()}}function d(e){return function(e,t){let l=Object.assign({loader:null,loading:null,delay:200,timeout:null,webpack:null,modules:null},t),n=null;function i(){if(!n){let t=new u(e,l);n={getCurrentValue:t.getCurrentValue.bind(t),subscribe:t.subscribe.bind(t),retry:t.retry.bind(t),promise:t.promise.bind(t)}}return n.promise()}if(!s){let e=l.webpack?l.webpack():l.modules;e&&o.push(t=>{for(let l of e)if(t.includes(l))return i()})}function c(e,t){!function(){i();let e=r.default.useContext(a.LoadableContext);e&&Array.isArray(l.modules)&&l.modules.forEach(t=>{e(t)})}();let o=r.default.useSyncExternalStore(n.subscribe,n.getCurrentValue,n.getCurrentValue);return r.default.useImperativeHandle(t,()=>({retry:n.retry}),[]),r.default.useMemo(()=>{var t;return o.loading||o.error?r.default.createElement(l.loading,{isLoading:o.loading,pastDelay:o.pastDelay,timedOut:o.timedOut,error:o.error,retry:n.retry}):o.loaded?r.default.createElement((t=o.loaded)&&t.default?t.default:t,e):null},[e,o])}return c.preload=()=>i(),c.displayName="LoadableComponent",r.default.forwardRef(c)}(c,e)}function m(e,t){let l=[];for(;e.length;){let n=e.pop();l.push(n(t))}return Promise.all(l).then(()=>{if(e.length)return m(e,t)})}d.preloadAll=()=>new Promise((e,t)=>{m(i).then(e,t)}),d.preloadReady=e=>(void 0===e&&(e=[]),new Promise(t=>{let l=()=>(s=!0,t());m(o,e).then(l,l)})),window.__NEXT_PRELOADREADY=d.preloadReady;let f=d},26784:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return Q}});var n=l(85893),r=l(60778),a=l(85576),i=l(50136),o=l(67294),s=function(e){let{items:t,modal:l}=e,[r,s]=(0,o.useState)("edit");return(0,n.jsx)(a.default,{...l,children:(0,n.jsxs)("div",{className:"flex justify-between gap-4",children:[(0,n.jsx)("div",{className:"w-1/6",children:(0,n.jsx)(i.Z,{className:"h-full",selectedKeys:[r],mode:"inline",onSelect:e=>{s(e.key)},inlineCollapsed:!1,items:t.map(e=>({key:e.key,label:e.label}))})}),(0,n.jsx)("div",{className:"w-5/6",children:t.map(e=>{if(e.key===r)return(0,n.jsx)(o.Fragment,{children:e.children},e.key)})})]})})},c=l(18102),u=l(68795),d=l(3089),m=l(24969),f=l(65654),p=l(99859),h=l(36447),v=l(93967),x=l.n(v),g=l(50344),b=l(64217),y=l(96159),j=l(53124),_=l(80882),w=l(7743);let k=e=>{let{children:t}=e,{getPrefixCls:l}=o.useContext(j.E_),n=l("breadcrumb");return o.createElement("li",{className:`${n}-separator`,"aria-hidden":"true"},""===t?t:t||"/")};k.__ANT_BREADCRUMB_SEPARATOR=!0;var C=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)0>t.indexOf(n[r])&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(l[n[r]]=e[n[r]]);return l};function N(e,t,l,n){if(null==l)return null;let{className:r,onClick:a}=t,i=C(t,["className","onClick"]),s=Object.assign(Object.assign({},(0,b.Z)(i,{data:!0,aria:!0})),{onClick:a});return void 0!==n?o.createElement("a",Object.assign({},s,{className:x()(`${e}-link`,r),href:n}),l):o.createElement("span",Object.assign({},s,{className:x()(`${e}-link`,r)}),l)}var O=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)0>t.indexOf(n[r])&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(l[n[r]]=e[n[r]]);return l};let S=e=>{let{prefixCls:t,separator:l="/",children:n,menu:r,overlay:a,dropdownProps:i,href:s}=e,c=(e=>{if(r||a){let l=Object.assign({},i);if(r){let e=r||{},{items:t}=e,n=O(e,["items"]);l.menu=Object.assign(Object.assign({},n),{items:null==t?void 0:t.map((e,t)=>{var{key:l,title:n,label:r,path:a}=e,i=O(e,["key","title","label","path"]);let c=null!=r?r:n;return a&&(c=o.createElement("a",{href:`${s}${a}`},c)),Object.assign(Object.assign({},i),{key:null!=l?l:t,label:c})})})}else a&&(l.overlay=a);return o.createElement(w.Z,Object.assign({placement:"bottom"},l),o.createElement("span",{className:`${t}-overlay-link`},e,o.createElement(_.Z,null)))}return e})(n);return null!=c?o.createElement(o.Fragment,null,o.createElement("li",null,c),l&&o.createElement(k,null,l)):null},Z=e=>{let{prefixCls:t,children:l,href:n}=e,r=O(e,["prefixCls","children","href"]),{getPrefixCls:a}=o.useContext(j.E_),i=a("breadcrumb",t);return o.createElement(S,Object.assign({},r,{prefixCls:i}),N(i,r,l,n))};Z.__ANT_BREADCRUMB_ITEM=!0;var E=l(11568),R=l(14747),P=l(83559),M=l(83262);let T=e=>{let{componentCls:t,iconCls:l,calc:n}=e;return{[t]:Object.assign(Object.assign({},(0,R.Wf)(e)),{color:e.itemColor,fontSize:e.fontSize,[l]:{fontSize:e.iconFontSize},ol:{display:"flex",flexWrap:"wrap",margin:0,padding:0,listStyle:"none"},a:Object.assign({color:e.linkColor,transition:`color ${e.motionDurationMid}`,padding:`0 ${(0,E.bf)(e.paddingXXS)}`,borderRadius:e.borderRadiusSM,height:e.fontHeight,display:"inline-block",marginInline:n(e.marginXXS).mul(-1).equal(),"&:hover":{color:e.linkHoverColor,backgroundColor:e.colorBgTextHover}},(0,R.Qy)(e)),"li:last-child":{color:e.lastItemColor},[`${t}-separator`]:{marginInline:e.separatorMargin,color:e.separatorColor},[`${t}-link`]:{[`
          > ${l} + span,
          > ${l} + a
        `]:{marginInlineStart:e.marginXXS}},[`${t}-overlay-link`]:{borderRadius:e.borderRadiusSM,height:e.fontHeight,display:"inline-block",padding:`0 ${(0,E.bf)(e.paddingXXS)}`,marginInline:n(e.marginXXS).mul(-1).equal(),[`> ${l}`]:{marginInlineStart:e.marginXXS,fontSize:e.fontSizeIcon},"&:hover":{color:e.linkHoverColor,backgroundColor:e.colorBgTextHover,a:{color:e.linkHoverColor}},a:{"&:hover":{backgroundColor:"transparent"}}},[`&${e.componentCls}-rtl`]:{direction:"rtl"}})}};var A=(0,P.I$)("Breadcrumb",e=>{let t=(0,M.IX)(e,{});return T(t)},e=>({itemColor:e.colorTextDescription,lastItemColor:e.colorText,iconFontSize:e.fontSize,linkColor:e.colorTextDescription,linkHoverColor:e.colorText,separatorColor:e.colorTextDescription,separatorMargin:e.marginXS})),I=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)0>t.indexOf(n[r])&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(l[n[r]]=e[n[r]]);return l};function z(e){let{breadcrumbName:t,children:l}=e,n=I(e,["breadcrumbName","children"]),r=Object.assign({title:t},n);return l&&(r.menu={items:l.map(e=>{var{breadcrumbName:t}=e;return Object.assign(Object.assign({},I(e,["breadcrumbName"])),{title:t})})}),r}var $=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)0>t.indexOf(n[r])&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(l[n[r]]=e[n[r]]);return l};let D=(e,t)=>{if(void 0===t)return t;let l=(t||"").replace(/^\//,"");return Object.keys(e).forEach(t=>{l=l.replace(`:${t}`,e[t])}),l},V=e=>{let t;let{prefixCls:l,separator:n="/",style:r,className:a,rootClassName:i,routes:s,items:c,children:u,itemRender:d,params:m={}}=e,f=$(e,["prefixCls","separator","style","className","rootClassName","routes","items","children","itemRender","params"]),{getPrefixCls:p,direction:h,breadcrumb:v}=o.useContext(j.E_),_=p("breadcrumb",l),[w,C,O]=A(_),Z=(0,o.useMemo)(()=>c||(s?s.map(z):null),[c,s]),E=(e,t,l,n,r)=>{if(d)return d(e,t,l,n);let a=function(e,t){if(void 0===e.title||null===e.title)return null;let l=Object.keys(t).join("|");return"object"==typeof e.title?e.title:String(e.title).replace(RegExp(`:(${l})`,"g"),(e,l)=>t[l]||e)}(e,t);return N(_,e,a,r)};if(Z&&Z.length>0){let e=[],l=c||s;t=Z.map((t,r)=>{let{path:a,key:i,type:s,menu:c,overlay:u,onClick:d,className:f,separator:p,dropdownProps:h}=t,v=D(m,a);void 0!==v&&e.push(v);let x=null!=i?i:r;if("separator"===s)return o.createElement(k,{key:x},p);let g={},y=r===Z.length-1;c?g.menu=c:u&&(g.overlay=u);let{href:j}=t;return e.length&&void 0!==v&&(j=`#/${e.join("/")}`),o.createElement(S,Object.assign({key:x},g,(0,b.Z)(t,{data:!0,aria:!0}),{className:f,dropdownProps:h,href:j,separator:y?"":n,onClick:d,prefixCls:_}),E(t,m,l,e,j))})}else if(u){let e=(0,g.Z)(u).length;t=(0,g.Z)(u).map((t,l)=>t?(0,y.Tm)(t,{separator:l===e-1?"":n,key:l}):t)}let R=x()(_,null==v?void 0:v.className,{[`${_}-rtl`]:"rtl"===h},a,i,C,O),P=Object.assign(Object.assign({},null==v?void 0:v.style),r);return w(o.createElement("nav",Object.assign({className:R,style:P},f),o.createElement("ol",null,t)))};V.Item=Z,V.Separator=k;var q=l(38289),L=l(74330),H=l(4393),X=l(42075),B=l(66309),F=l(32983),U=l(11004),J=l(77683),W=l(96486),G=l(11163),K=l(67421),Q=function(){let e=(0,G.useRouter)(),{t}=(0,K.$G)(),[l,a]=(0,o.useState)([]),[i,v]=(0,o.useState)(0),[g,b]=(0,o.useState)(!1),[y,j]=(0,o.useState)(!1),[_,w]=(0,o.useState)(null),[k,C]=(0,o.useState)(1),[N,O]=(0,o.useState)(10),[S]=p.Z.useForm(),{message:Z}=h.Z.useApp(),{query:{id:E,spaceName:R}}=(0,G.useRouter)(),P=async()=>{var e;b(!0);let[t,l]=await (0,r.Vx)((0,r.gV)(R,{document_id:E,page:1,page_size:10}));a(null==l?void 0:l.data),v(null!==(e=null==l?void 0:l.total)&&void 0!==e?e:0),b(!1)},M=async(e,t)=>{O(t),b(!0);let[l,n]=await (0,r.Vx)((0,r.gV)(R,{document_id:E,page:e,page_size:t}));a((null==n?void 0:n.data)||[]),b(!1),C(e)};(0,o.useEffect)(()=>{R&&E&&P()},[E,R]);let T=async e=>{let t=e.target.value;if(!t)return;let[l,n]=await (0,r.Vx)((0,r.gV)(R,{document_id:E,page:k,page_size:N,content:t}));a((null==n?void 0:n.data)||[])},{run:A,loading:I}=(0,f.Z)(async e=>(0,r.Vx)((0,r.fU)({chunk_id:_.id,questions:e})),{manual:!0,onSuccess:async()=>{Z.success("添加成功"),j(!1),await P()}});return(0,n.jsxs)("div",{className:"flex flex-col h-full w-full px-6 pb-6",children:[(0,n.jsx)(V,{className:"m-6",items:[{title:"Knowledge",onClick(){e.back()},path:"/knowledge"},{title:R}]}),(0,n.jsx)("div",{className:"flex items-center gap-4",children:(0,n.jsx)(q.default,{className:"w-1/5 h-10 mb-4",prefix:(0,n.jsx)(u.Z,{}),placeholder:t("please_enter_the_keywords"),onChange:(0,W.debounce)(T,300),allowClear:!0})}),(null==l?void 0:l.length)>0?(0,n.jsxs)("div",{className:"h-full grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4  grid-flow-row auto-rows-max gap-x-6 gap-y-10 overflow-y-auto relative",children:[(0,n.jsx)(L.Z,{className:"flex flex-col items-center justify-center absolute bottom-0 top-0 left-0 right-0",spinning:g}),null==l?void 0:l.map((e,l)=>(0,n.jsxs)(H.Z,{hoverable:!0,title:(0,n.jsxs)(X.Z,{className:"flex justify-between",children:[(0,n.jsxs)(B.Z,{color:"blue",children:["# ",l+(k-1)*10]}),(0,n.jsx)("span",{className:"text-sm",children:e.doc_name})]}),className:x()("h-96 rounded-xl overflow-hidden",{"h-auto":!0}),onClick:()=>{j(!0),w(e)},children:[(0,n.jsxs)("p",{className:"font-semibold",children:[t("Content"),":"]}),(0,n.jsx)("p",{children:null==e?void 0:e.content}),(0,n.jsxs)("p",{className:"font-semibold",children:[t("Meta_Data"),": "]}),(0,n.jsx)("p",{children:null==e?void 0:e.meta_info})]},e.id))]}):(0,n.jsx)(L.Z,{spinning:g,children:(0,n.jsx)(F.Z,{image:F.Z.PRESENTED_IMAGE_DEFAULT})}),(0,n.jsx)(U.Z,{className:"flex w-full justify-end",defaultCurrent:1,defaultPageSize:10,total:i,showTotal:e=>"Total ".concat(e," items"),onChange:M}),(0,n.jsx)(s,{modal:{title:t("Manual_entry"),width:"70%",open:y,footer:!1,onCancel:()=>j(!1),afterOpenChange:e=>{if(e){var t;S.setFieldValue("questions",null===(t=JSON.parse((null==_?void 0:_.questions)||"[]"))||void 0===t?void 0:t.map(e=>({question:e})))}}},items:[{key:"edit",label:t("Data_content"),children:(0,n.jsxs)("div",{className:"flex gap-4",children:[(0,n.jsx)(H.Z,{size:"small",title:t("Main_content"),className:"w-2/3 flex-wrap overflow-y-auto",children:(0,n.jsx)(c.default,{children:null==_?void 0:_.content})}),(0,n.jsx)(H.Z,{size:"small",title:t("Auxiliary_data"),className:"w-1/3",children:(0,n.jsx)(c.default,{children:null==_?void 0:_.meta_info})})]})},{key:"delete",label:t("Add_problem"),children:(0,n.jsx)(H.Z,{size:"small",extra:(0,n.jsx)(J.ZP,{size:"small",type:"primary",onClick:async()=>{var e,l;let n=S.getFieldsValue();if(!n.questions||(null===(e=n.questions)||void 0===e?void 0:e.filter(Boolean).length)===0){Z.warning(t("enter_question_first"));return}let r=null===(l=n.questions)||void 0===l?void 0:l.filter(Boolean).map(e=>e.question);await A(r)},loading:I,children:t("save")}),children:(0,n.jsx)(p.Z,{form:S,children:(0,n.jsx)(p.Z.List,{name:"questions",children:(e,l)=>{let{add:r,remove:a}=l;return(0,n.jsxs)(n.Fragment,{children:[e.map(e=>{let{key:l,name:r}=e;return(0,n.jsxs)("div",{className:x()("flex flex-1 items-center gap-8"),children:[(0,n.jsx)(p.Z.Item,{label:"",name:[r,"question"],className:"grow",children:(0,n.jsx)(q.default,{placeholder:t("Please_Input")})}),(0,n.jsx)(p.Z.Item,{children:(0,n.jsx)(d.Z,{onClick:()=>{a(r)}})})]},l)}),(0,n.jsx)(p.Z.Item,{children:(0,n.jsx)(J.ZP,{type:"dashed",onClick:()=>{r()},block:!0,icon:(0,n.jsx)(m.Z,{}),children:t("Add_problem")})})]})}})})})}]})]})}},56397:function(e,t,l){"use strict";l.r(t);var n=l(85893),r=l(48218),a=l(58638),i=l(36447),o=l(25593),s=l(20640),c=l.n(s),u=l(67294),d=l(23820);t.default=(0,u.memo)(()=>{var e;let{appInfo:t}=(0,u.useContext)(d.MobileChatContext),{message:l}=i.Z.useApp(),[s,m]=(0,u.useState)(0);if(!(null==t?void 0:t.app_code))return null;let f=async()=>{let e=c()("dingtalk://dingtalkclient/page/link?url=".concat(encodeURIComponent(location.href),"&pc_slide=true"));l[e?"success":"error"](e?"复制成功":"复制失败")};return s>6&&l.info(JSON.stringify(window.navigator.userAgent),2,()=>{m(0)}),(0,n.jsxs)("header",{className:"flex w-full items-center justify-between bg-[rgba(255,255,255,0.9)] border dark:bg-black dark:border-[rgba(255,255,255,0.6)] rounded-xl mx-auto px-4 py-2 mb-4 sticky top-4 z-50 mt-4 shadow-md",children:[(0,n.jsxs)("div",{className:"flex gap-2 items-center",onClick:()=>m(s+1),children:[(0,n.jsx)(r.Z,{scene:(null==t?void 0:null===(e=t.team_context)||void 0===e?void 0:e.chat_scene)||"chat_agent",width:8,height:8}),(0,n.jsxs)("div",{className:"flex flex-col ml-2",children:[(0,n.jsx)(o.Z.Text,{className:"text-md font-bold line-clamp-2",children:null==t?void 0:t.app_name}),(0,n.jsx)(o.Z.Text,{className:"text-sm line-clamp-2",children:null==t?void 0:t.app_describe})]})]}),(0,n.jsx)("div",{onClick:f,className:"flex items-center justify-center w-10 h-10 bg-[#ffffff99] dark:bg-[rgba(255,255,255,0.2)] border border-white dark:border-[rgba(255,255,255,0.2)] rounded-[50%] cursor-pointer",children:(0,n.jsx)(a.Z,{className:"text-lg"})})]})})},74638:function(e,t,l){"use strict";l.r(t);var n=l(85893),r=l(60778),a=l(62418),i=l(25519),o=l(30159),s=l(87740),c=l(50888),u=l(52645),d=l(27496),m=l(1375),f=l(65654),p=l(66309),h=l(55241),v=l(74330),x=l(38289),g=l(77683),b=l(93967),y=l.n(b),j=l(39332),_=l(67294),w=l(23820),k=l(7001),C=l(73749),N=l(97109),O=l(83454);let S=["magenta","orange","geekblue","purple","cyan","green"];t.default=()=>{var e,t;let l=(0,j.useSearchParams)(),b=null!==(t=null==l?void 0:l.get("ques"))&&void 0!==t?t:"",{history:Z,model:E,scene:R,temperature:P,resource:M,conv_uid:T,appInfo:A,scrollViewRef:I,order:z,userInput:$,ctrl:D,canAbort:V,canNewChat:q,setHistory:L,setCanNewChat:H,setCarAbort:X,setUserInput:B}=(0,_.useContext)(w.MobileChatContext),[F,U]=(0,_.useState)(!1),[J,W]=(0,_.useState)(!1),G=async e=>{var t,l,n;B(""),D.current=new AbortController;let r={chat_mode:R,model_name:E,user_input:e||$,conv_uid:T,temperature:P,app_code:null==A?void 0:A.app_code,...M&&{select_param:JSON.stringify(M)}};if(Z&&Z.length>0){let e=null==Z?void 0:Z.filter(e=>"view"===e.role);z.current=e[e.length-1].order+1}let o=[{role:"human",context:e||$,model_name:E,order:z.current,time_stamp:0},{role:"view",context:"",model_name:E,order:z.current,time_stamp:0,thinking:!0}],s=o.length-1;L([...Z,...o]),H(!1);try{await (0,m.L)("".concat(null!==(t=O.env.API_BASE_URL)&&void 0!==t?t:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[i.gp]:null!==(l=(0,a.n5)())&&void 0!==l?l:""},signal:D.current.signal,body:JSON.stringify(r),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===m.a)return},onclose(){var e;null===(e=D.current)||void 0===e||e.abort(),H(!0),X(!1)},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;try{t=JSON.parse(t).vis}catch(e){t.replaceAll("\\n","\n")}"[DONE]"===t?(H(!0),X(!1)):(null==t?void 0:t.startsWith("[ERROR]"))?(o[s].context=null==t?void 0:t.replace("[ERROR]",""),o[s].thinking=!1,L([...Z,...o]),H(!0),X(!1)):(X(!0),o[s].context=t,o[s].thinking=!1,L([...Z,...o]))}})}catch(e){null===(n=D.current)||void 0===n||n.abort(),o[s].context="Sorry, we meet some error, please try again later.",o[s].thinking=!1,L([...o]),H(!0),X(!1)}},K=async()=>{$.trim()&&q&&await G()};(0,_.useEffect)(()=>{var e,t;null===(e=I.current)||void 0===e||e.scrollTo({top:null===(t=I.current)||void 0===t?void 0:t.scrollHeight,behavior:"auto"})},[Z,I]);let Q=(0,_.useMemo)(()=>{if(!A)return[];let{param_need:e=[]}=A;return null==e?void 0:e.map(e=>e.type)},[A]),Y=(0,_.useMemo)(()=>{var e;return 0===Z.length&&A&&!!(null==A?void 0:null===(e=A.recommend_questions)||void 0===e?void 0:e.length)},[Z,A]),{run:ee,loading:et}=(0,f.Z)(async()=>await (0,r.Vx)((0,r.zR)(T)),{manual:!0,onSuccess:()=>{L([])}});return(0,_.useEffect)(()=>{b&&E&&T&&A&&G(b)},[A,T,E,b]),(0,n.jsxs)("div",{className:"flex flex-col",children:[Y&&(0,n.jsx)("ul",{children:null==A?void 0:null===(e=A.recommend_questions)||void 0===e?void 0:e.map((e,t)=>(0,n.jsx)("li",{className:"mb-3",children:(0,n.jsx)(p.Z,{color:S[t],className:"p-2 rounded-xl",onClick:async()=>{G(e.question)},children:e.question})},e.id))}),(0,n.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,n.jsxs)("div",{className:"flex gap-2 mb-1 w-full overflow-x-auto",children:[(null==Q?void 0:Q.includes("model"))&&(0,n.jsx)(k.default,{}),(null==Q?void 0:Q.includes("resource"))&&(0,n.jsx)(C.default,{}),(null==Q?void 0:Q.includes("temperature"))&&(0,n.jsx)(N.default,{})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between text-lg font-bold",children:[(0,n.jsx)(h.Z,{content:"暂停回复",trigger:["hover"],children:(0,n.jsx)(o.Z,{className:y()("p-2 cursor-pointer",{"text-[#0c75fc]":V,"text-gray-400":!V}),onClick:()=>{var e;V&&(null===(e=D.current)||void 0===e||e.abort(),setTimeout(()=>{X(!1),H(!0)},100))}})}),(0,n.jsx)(h.Z,{content:"再来一次",trigger:["hover"],children:(0,n.jsx)(s.Z,{className:y()("p-2 cursor-pointer",{"text-gray-400":!Z.length||!q}),onClick:()=>{var e,t;if(!q||0===Z.length)return;let l=null===(e=null===(t=Z.filter(e=>"human"===e.role))||void 0===t?void 0:t.slice(-1))||void 0===e?void 0:e[0];G((null==l?void 0:l.context)||"")}})}),et?(0,n.jsx)(v.Z,{spinning:et,indicator:(0,n.jsx)(c.Z,{style:{fontSize:18},spin:!0}),className:"p-2"}):(0,n.jsx)(h.Z,{content:"清除历史",trigger:["hover"],children:(0,n.jsx)(u.Z,{className:y()("p-2 cursor-pointer",{"text-gray-400":!Z.length||!q}),onClick:()=>{q&&ee()}})})]})]}),(0,n.jsxs)("div",{className:y()("flex py-2 px-3 items-center justify-between bg-white dark:bg-[#242733] dark:border-[#6f7f95] rounded-xl border",{"border-[#0c75fc] dark:border-[rgba(12,117,252,0.8)]":F}),children:[(0,n.jsx)(x.default.TextArea,{placeholder:"可以问我任何问题",className:"w-full resize-none border-0 p-0 focus:shadow-none",value:$,autoSize:{minRows:1},onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey){if(J){e.preventDefault();return}$.trim()&&(e.preventDefault(),K())}},onChange:e=>{B(e.target.value)},onFocus:()=>{U(!0)},onBlur:()=>U(!1),onCompositionStartCapture:()=>{W(!0)},onCompositionEndCapture:()=>{setTimeout(()=>{W(!1)},0)}}),(0,n.jsx)(g.ZP,{type:"primary",className:y()("flex items-center justify-center rounded-lg bg-button-gradient border-0 ml-2",{"opacity-40 cursor-not-allowed":!$.trim()||!q}),onClick:K,children:q?(0,n.jsx)(d.Z,{}):(0,n.jsx)(v.Z,{indicator:(0,n.jsx)(c.Z,{className:"text-white"})})})]})]})}},7001:function(e,t,l){"use strict";l.r(t);var n=l(85893),r=l(41468),a=l(39718),i=l(94668),o=l(85418),s=l(55241),c=l(67294),u=l(23820);t.default=()=>{let{modelList:e}=(0,c.useContext)(r.p),{model:t,setModel:l}=(0,c.useContext)(u.MobileChatContext),d=(0,c.useMemo)(()=>e.length>0?e.map(e=>({label:(0,n.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{l(e)},children:[(0,n.jsx)(a.Z,{width:14,height:14,model:e}),(0,n.jsx)("span",{className:"text-xs",children:e})]}),key:e})):[],[e,l]);return(0,n.jsx)(o.Z,{menu:{items:d},placement:"top",trigger:["click"],children:(0,n.jsx)(s.Z,{content:t,children:(0,n.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,n.jsx)(a.Z,{width:16,height:16,model:t}),(0,n.jsx)("span",{className:"text-xs font-medium line-clamp-1",style:{maxWidth:96},children:t}),(0,n.jsx)(i.Z,{rotate:90})]})})})}},46568:function(e,t,l){"use strict";l.r(t);var n=l(85893),r=l(25675),a=l.n(r),i=l(67294);t.default=(0,i.memo)(e=>{let{width:t,height:l,src:r,label:i}=e;return(0,n.jsx)(a(),{width:t||14,height:l||14,src:r,alt:i||"db-icon",priority:!0})})},73749:function(e,t,l){"use strict";l.r(t);var n=l(85893),r=l(60778),a=l(16520),i=l(62418),o=l(50888),s=l(94668),c=l(83266),u=l(65654),d=l(74330),m=l(84553),f=l(85418),p=l(67294),h=l(23820),v=l(46568);t.default=()=>{let{appInfo:e,resourceList:t,scene:l,model:x,conv_uid:g,getChatHistoryRun:b,setResource:y,resource:j}=(0,p.useContext)(h.MobileChatContext),{temperatureValue:_,maxNewTokensValue:w}=(0,p.useContext)(a.ChatContentContext),[k,C]=(0,p.useState)(null),N=(0,p.useMemo)(()=>{var t,l,n;return null===(t=null==e?void 0:null===(l=e.param_need)||void 0===l?void 0:l.filter(e=>"resource"===e.type))||void 0===t?void 0:null===(n=t[0])||void 0===n?void 0:n.value},[e]),O=(0,p.useMemo)(()=>t&&t.length>0?t.map(e=>({label:(0,n.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{C(e),y(e.space_id||e.param)},children:[(0,n.jsx)(v.default,{width:14,height:14,src:i.S$[e.type].icon,label:i.S$[e.type].label}),(0,n.jsx)("span",{className:"text-xs",children:e.param})]}),key:e.space_id||e.param})):[],[t,y]),{run:S,loading:Z}=(0,u.Z)(async e=>{let[,t]=await (0,r.Vx)((0,r.qn)({convUid:g,chatMode:l,data:e,model:x,temperatureValue:_,maxNewTokensValue:w,config:{timeout:36e5}}));return y(t),t},{manual:!0,onSuccess:async()=>{await b()}}),E=async e=>{let t=new FormData;t.append("doc_file",null==e?void 0:e.file),await S(t)},R=(0,p.useMemo)(()=>Z?(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(d.Z,{size:"small",indicator:(0,n.jsx)(o.Z,{spin:!0})}),(0,n.jsx)("span",{className:"text-xs",children:"上传中"})]}):j?(0,n.jsxs)("div",{className:"flex gap-1",children:[(0,n.jsx)("span",{className:"text-xs",children:j.file_name}),(0,n.jsx)(s.Z,{rotate:90})]}):(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(c.Z,{className:"text-base"}),(0,n.jsx)("span",{className:"text-xs",children:"上传文件"})]}),[Z,j]);return(0,n.jsx)(n.Fragment,{children:(()=>{switch(N){case"excel_file":case"text_file":case"image_file":return(0,n.jsx)("div",{className:"flex items-center justify-center gap-1 border rounded-xl bg-white dark:bg-black px-2 flex-shrink-0",children:(0,n.jsx)(m.default,{name:"file",accept:".xlsx,.xls",maxCount:1,showUploadList:!1,beforeUpload:()=>!1,onChange:E,className:"flex h-full w-full items-center justify-center",children:R})});case"database":case"knowledge":case"plugin":case"awel_flow":var e,l,r,a,o;if(!(null==t?void 0:t.length))return null;return(0,n.jsx)(f.Z,{menu:{items:O},placement:"top",trigger:["click"],children:(0,n.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,n.jsx)(v.default,{width:14,height:14,src:null===(e=i.S$[(null==k?void 0:k.type)||(null==t?void 0:null===(l=t[0])||void 0===l?void 0:l.type)])||void 0===e?void 0:e.icon,label:null===(r=i.S$[(null==k?void 0:k.type)||(null==t?void 0:null===(a=t[0])||void 0===a?void 0:a.type)])||void 0===r?void 0:r.label}),(0,n.jsx)("span",{className:"text-xs font-medium",children:(null==k?void 0:k.param)||(null==t?void 0:null===(o=t[0])||void 0===o?void 0:o.param)}),(0,n.jsx)(s.Z,{rotate:90})]})})}})()})}},97109:function(e,t,l){"use strict";l.r(t);var n=l(85893),r=l(70065),a=l(85418),i=l(30568),o=l(67294),s=l(23820);t.default=()=>{let{temperature:e,setTemperature:t}=(0,o.useContext)(s.MobileChatContext),l=e=>{isNaN(e)||t(e)};return(0,n.jsx)(a.Z,{trigger:["click"],dropdownRender:()=>(0,n.jsx)("div",{className:"flex h-28 bg-white dark:bg-[rgba(255,255,255,0.5)] items-center justify-center rounded-xl py-3",children:(0,n.jsx)(i.Z,{defaultValue:.5,max:1,min:0,step:.1,vertical:!0,onChange:l,value:e})}),placement:"top",children:(0,n.jsxs)("div",{className:"flex items-center justify-between border rounded-xl bg-white dark:bg-black w-14 p-2 flex-shrink-0",children:[(0,n.jsx)(r.Z,{type:"icon-icons-temperature",className:"text-sm"}),(0,n.jsx)("span",{className:"text-xs font-medium",children:e})]})})}},23820:function(e,t,l){"use strict";l.r(t),l.d(t,{MobileChatContext:function(){return y},default:function(){return j}});var n=l(85893),r=l(41468),a=l(60778),i=l(25519),o=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(i.C9))&&void 0!==e?e:"")},s=l(62418),c=l(1375),u=l(65654),d=l(74330),m=l(5152),f=l.n(m),p=l(39332),h=l(67294),v=l(56397),x=l(74638),g=l(83454);let b=f()(()=>Promise.all([l.e(3662),l.e(1265),l.e(7034),l.e(4567),l.e(2398),l.e(1004),l.e(5265),l.e(7426),l.e(3627),l.e(4866),l.e(9685),l.e(5789),l.e(2925)]).then(l.bind(l,36818)),{loadableGenerated:{webpack:()=>[36818]},ssr:!1}),y=(0,h.createContext)({model:"",temperature:.5,resource:null,setModel:()=>{},setTemperature:()=>{},setResource:()=>{},scene:"",history:[],setHistory:()=>{},scrollViewRef:{current:null},appInfo:{},conv_uid:"",resourceList:[],order:{current:1},handleChat:()=>Promise.resolve(),canAbort:!1,setCarAbort:()=>{},canNewChat:!1,setCanNewChat:()=>{},ctrl:{current:void 0},userInput:"",setUserInput:()=>{},getChatHistoryRun:()=>{}});var j=()=>{var e,t;let l=(0,p.useSearchParams)(),m=null!==(e=null==l?void 0:l.get("chat_scene"))&&void 0!==e?e:"",f=null!==(t=null==l?void 0:l.get("app_code"))&&void 0!==t?t:"",{modelList:j}=(0,h.useContext)(r.p),[_,w]=(0,h.useState)([]),[k,C]=(0,h.useState)(""),[N,O]=(0,h.useState)(.5),[S,Z]=(0,h.useState)(null),E=(0,h.useRef)(null),[R,P]=(0,h.useState)(""),[M,T]=(0,h.useState)(!1),[A,I]=(0,h.useState)(!0),z=(0,h.useRef)(),$=(0,h.useRef)(1),D=o(),V=(0,h.useMemo)(()=>"".concat(null==D?void 0:D.user_no,"_").concat(f),[f,D]),{run:q,loading:L}=(0,u.Z)(async()=>await (0,a.Vx)((0,a.$i)("".concat(null==D?void 0:D.user_no,"_").concat(f))),{manual:!0,onSuccess:e=>{let[,t]=e,l=null==t?void 0:t.filter(e=>"view"===e.role);l&&l.length>0&&($.current=l[l.length-1].order+1),w(t||[])}}),{data:H,run:X,loading:B}=(0,u.Z)(async e=>{let[,t]=await (0,a.Vx)((0,a.BN)(e));return null!=t?t:{}},{manual:!0}),{run:F,data:U,loading:J}=(0,u.Z)(async()=>{var e,t;let[,l]=await (0,a.Vx)((0,a.vD)(m));return Z((null==l?void 0:null===(e=l[0])||void 0===e?void 0:e.space_id)||(null==l?void 0:null===(t=l[0])||void 0===t?void 0:t.param)),null!=l?l:[]},{manual:!0}),{run:W,loading:G}=(0,u.Z)(async()=>{let[,e]=await (0,a.Vx)((0,a.iP)());return null!=e?e:[]},{manual:!0,onSuccess:e=>{var t;let l=null===(t=null==e?void 0:e.filter(e=>e.conv_uid===V))||void 0===t?void 0:t[0];(null==l?void 0:l.select_param)&&Z(JSON.parse(null==l?void 0:l.select_param))}});(0,h.useEffect)(()=>{m&&f&&j.length&&X({chat_scene:m,app_code:f})},[f,m,X,j]),(0,h.useEffect)(()=>{f&&q()},[f]),(0,h.useEffect)(()=>{if(j.length>0){var e,t,l;let n=null===(e=null==H?void 0:null===(t=H.param_need)||void 0===t?void 0:t.filter(e=>"model"===e.type))||void 0===e?void 0:null===(l=e[0])||void 0===l?void 0:l.value;C(n||j[0])}},[j,H]),(0,h.useEffect)(()=>{var e,t,l;let n=null===(e=null==H?void 0:null===(t=H.param_need)||void 0===t?void 0:t.filter(e=>"temperature"===e.type))||void 0===e?void 0:null===(l=e[0])||void 0===l?void 0:l.value;O(n||.5)},[H]),(0,h.useEffect)(()=>{if(m&&(null==H?void 0:H.app_code)){var e,t,l,n,r,a;let i=null===(e=null==H?void 0:null===(t=H.param_need)||void 0===t?void 0:t.filter(e=>"resource"===e.type))||void 0===e?void 0:null===(l=e[0])||void 0===l?void 0:l.value,o=null===(n=null==H?void 0:null===(r=H.param_need)||void 0===r?void 0:r.filter(e=>"resource"===e.type))||void 0===n?void 0:null===(a=n[0])||void 0===a?void 0:a.bind_value;o&&Z(o),["database","knowledge","plugin","awel_flow"].includes(i)&&!o&&F()}},[H,m,F]);let K=async e=>{var t,l,n;P(""),z.current=new AbortController;let r={chat_mode:m,model_name:k,user_input:e||R,conv_uid:V,temperature:N,app_code:null==H?void 0:H.app_code,...S&&{select_param:S}};if(_&&_.length>0){let e=null==_?void 0:_.filter(e=>"view"===e.role);$.current=e[e.length-1].order+1}let a=[{role:"human",context:e||R,model_name:k,order:$.current,time_stamp:0},{role:"view",context:"",model_name:k,order:$.current,time_stamp:0,thinking:!0}],o=a.length-1;w([..._,...a]),I(!1);try{await (0,c.L)("".concat(null!==(t=g.env.API_BASE_URL)&&void 0!==t?t:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[i.gp]:null!==(l=(0,s.n5)())&&void 0!==l?l:""},signal:z.current.signal,body:JSON.stringify(r),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===c.a)return},onclose(){var e;null===(e=z.current)||void 0===e||e.abort(),I(!0),T(!1)},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;try{t=JSON.parse(t).vis}catch(e){t.replaceAll("\\n","\n")}"[DONE]"===t?(I(!0),T(!1)):(null==t?void 0:t.startsWith("[ERROR]"))?(a[o].context=null==t?void 0:t.replace("[ERROR]",""),a[o].thinking=!1,w([..._,...a]),I(!0),T(!1)):(T(!0),a[o].context=t,a[o].thinking=!1,w([..._,...a]))}})}catch(e){null===(n=z.current)||void 0===n||n.abort(),a[o].context="Sorry, we meet some error, please try again later.",a[o].thinking=!1,w([...a]),I(!0),T(!1)}};return(0,h.useEffect)(()=>{m&&"chat_agent"!==m&&W()},[m,W]),(0,n.jsx)(y.Provider,{value:{model:k,resource:S,setModel:C,setTemperature:O,setResource:Z,temperature:N,appInfo:H,conv_uid:V,scene:m,history:_,scrollViewRef:E,setHistory:w,resourceList:U,order:$,handleChat:K,setCanNewChat:I,ctrl:z,canAbort:M,setCarAbort:T,canNewChat:A,userInput:R,setUserInput:P,getChatHistoryRun:q},children:(0,n.jsx)(d.Z,{size:"large",className:"flex h-screen w-screen justify-center items-center max-h-screen",spinning:L||B||J||G,children:(0,n.jsxs)("div",{className:"flex flex-col h-screen bg-gradient-light dark:bg-gradient-dark p-4 pt-0",children:[(0,n.jsxs)("div",{ref:E,className:"flex flex-col flex-1 overflow-y-auto mb-3",children:[(0,n.jsx)(v.default,{}),(0,n.jsx)(b,{})]}),(null==H?void 0:H.app_code)&&(0,n.jsx)(x.default,{})]})})})}},5152:function(e,t,l){e.exports=l(50948)}},function(e){e.O(0,[3662,1265,7034,1449,8289,3791,5217,4330,8791,5593,3886,4435,6877,8591,9859,4567,2398,1004,5265,7426,3627,4866,9685,4627,6520,5789,9774,2888,179],function(){return e(e.s=45745)}),_N_E=e.O()}]);