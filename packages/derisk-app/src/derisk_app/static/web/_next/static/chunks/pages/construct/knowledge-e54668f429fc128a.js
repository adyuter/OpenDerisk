(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4554,3820],{45629:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/knowledge",function(){return t(14545)}])},14545:function(e,l,t){"use strict";let a;t.r(l),t.d(l,{default:function(){return eT}});var n=t(85893),s=t(41468),r=t(60778),i=t(50888),c=t(98165),o=t(28058),d=t(68795),u=t(99611),m=t(86548),x=t(48689),h=t(89705),p=t(24969),f=t(18754),j=t(13179),g=t(90725),_=t(3089),v=t(65654),b=t(85576),y=t(45360),Z=t(74330),N=t(42075),w=t(99859),k=t(83062),C=t(66309),S=t(77683),I=t(38289),T=t(4393),P=t(85418),E=t(32983),F=t(96074),q=t(93967),U=t.n(q),R=t(30381),D=t.n(R),A=t(11163),O=t(67294),V=t(67421),L=t(18102),M=t(42952),z=t(55241),G=t(24435),H=t(65217),Y=e=>{let{open:l,setOpen:t,space:a}=e,[s]=w.Z.useForm(),[i]=w.Z.useForm(),{run:c}=(0,v.Z)(async()=>{let[,e]=await (0,r.Vx)((0,r.Pg)(a.name+""));return null!=e?e:[]},{manual:!0}),{data:o=[],run:d}=(0,v.Z)(async()=>{let[,e]=await (0,r.Vx)((0,r.UO)(a.name+""));return null!=e?e:[]},{manual:!0,onSuccess:e=>{i.setFieldValue("recall_retrievers",e)}});(0,O.useEffect)(()=>{l&&d()},[l,d,c]);let{run:u,data:m=[],loading:x}=(0,v.Z)(async e=>{let[,l]=await (0,r.Vx)((0,r.Y2)({...e},a.name+""));return null!=l?l:[]},{manual:!0}),h=async()=>{s.validateFields().then(async e=>{let l=i.getFieldsValue();await u({recall_top_k:1,recall_retrievers:o,...e,...l})})};return(0,n.jsxs)(b.default,{title:"召回测试",width:"60%",open:l,footer:!1,onCancel:()=>t(!1),centered:!0,destroyOnClose:!0,children:[(0,n.jsx)(T.Z,{title:"召回配置",size:"small",className:"my-4",extra:(0,n.jsx)(z.Z,{placement:"bottomRight",trigger:"hover",title:"向量检索设置",content:(0,n.jsxs)(w.Z,{form:i,initialValues:{recall_top_k:1},children:[(0,n.jsx)(w.Z.Item,{label:"Topk",tooltip:"基于相似度得分的前 k 个向量",name:"recall_top_k",children:(0,n.jsx)(G.Z,{placeholder:"请输入",className:"w-full"})}),(0,n.jsx)(w.Z.Item,{label:"召回方法",name:"recall_retrievers",children:(0,n.jsx)(H.default,{mode:"multiple",options:o.map(e=>({label:e,value:e})),className:"w-full",allowClear:!0,disabled:!0})}),(0,n.jsx)(w.Z.Item,{label:"score阈值",name:"recall_score_threshold",children:(0,n.jsx)(G.Z,{placeholder:"请输入",className:"w-full",step:.1})})]}),children:(0,n.jsx)(M.Z,{className:"text-lg"})}),children:(0,n.jsx)(w.Z,{form:s,layout:"vertical",onFinish:h,children:(0,n.jsx)(w.Z.Item,{label:"测试问题",required:!0,name:"question",rules:[{required:!0,message:"请输入测试问题"}],className:"m-0 p-0",children:(0,n.jsxs)("div",{className:"flex w-full items-center gap-8",children:[(0,n.jsx)(I.default,{placeholder:"请输入测试问题",autoComplete:"off",allowClear:!0,className:"w-1/2"}),(0,n.jsx)(S.ZP,{type:"primary",htmlType:"submit",children:"测试"})]})})})}),(0,n.jsx)(T.Z,{title:"召回结果",size:"small",children:(0,n.jsx)(Z.Z,{spinning:x,children:m.length>0?(0,n.jsx)("div",{className:"flex flex-col overflow-y-auto",style:{height:"45vh"},children:m.map(e=>(0,n.jsx)(T.Z,{title:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsxs)(C.Z,{color:"blue",children:["# ",e.chunk_id]}),e.metadata.source]}),extra:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"font-semibold",children:"score:"}),(0,n.jsx)("span",{className:"text-blue-500",children:e.score})]}),size:"small",className:"mb-4 border-gray-500 shadow-md",children:(0,n.jsx)(L.default,{children:e.content})},e.chunk_id))}):(0,n.jsx)(E.Z,{})})})]})},$=t(71230),J=t(15746),W=t(92398),B=t(31545),K=t(6321),Q=t(90389);let{TextArea:X}=I.default;function ee(e){let{space:l,argumentsShow:t,setArgumentsShow:a}=e,{t:s}=(0,V.$G)(),[i,c]=(0,O.useState)(),[o,d]=(0,O.useState)(!1),u=async()=>{let[e,t]=await (0,r.Vx)((0,r.Tu)(l.name));c(t)};(0,O.useEffect)(()=>{u()},[l.name]);let m=[{key:"Embedding",label:(0,n.jsxs)("div",{children:[(0,n.jsx)(B.Z,{}),s("Embedding")]}),children:(0,n.jsxs)($.Z,{gutter:24,children:[(0,n.jsx)(J.Z,{span:12,offset:0,children:(0,n.jsx)(w.Z.Item,{tooltip:s("the_top_k_vectors"),rules:[{required:!0}],label:s("topk"),name:["embedding","topk"],children:(0,n.jsx)(I.default,{className:"mb-5 h-12"})})}),(0,n.jsx)(J.Z,{span:12,children:(0,n.jsx)(w.Z.Item,{tooltip:s("Set_a_threshold_score"),rules:[{required:!0}],label:s("recall_score"),name:["embedding","recall_score"],children:(0,n.jsx)(I.default,{className:"mb-5  h-12",placeholder:"请输入"})})}),(0,n.jsx)(J.Z,{span:12,children:(0,n.jsx)(w.Z.Item,{tooltip:s("recall_type"),rules:[{required:!0}],label:s("recall_type"),name:["embedding","recall_type"],children:(0,n.jsx)(I.default,{className:"mb-5  h-12"})})}),(0,n.jsx)(J.Z,{span:12,children:(0,n.jsx)(w.Z.Item,{tooltip:s("A_model_used"),rules:[{required:!0}],label:s("model"),name:["embedding","model"],children:(0,n.jsx)(I.default,{className:"mb-5  h-12"})})}),(0,n.jsx)(J.Z,{span:12,children:(0,n.jsx)(w.Z.Item,{tooltip:s("The_size_of_the_data_chunks"),rules:[{required:!0}],label:s("chunk_size"),name:["embedding","chunk_size"],children:(0,n.jsx)(I.default,{className:"mb-5  h-12"})})}),(0,n.jsx)(J.Z,{span:12,children:(0,n.jsx)(w.Z.Item,{tooltip:s("The_amount_of_overlap"),rules:[{required:!0}],label:s("chunk_overlap"),name:["embedding","chunk_overlap"],children:(0,n.jsx)(I.default,{className:"mb-5  h-12",placeholder:s("Please_input_the_description")})})})]})},{key:"Prompt",label:(0,n.jsxs)("div",{children:[(0,n.jsx)(K.Z,{}),s("Prompt")]}),children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w.Z.Item,{tooltip:s("A_contextual_parameter"),label:s("scene"),name:["prompt","scene"],children:(0,n.jsx)(X,{rows:4,className:"mb-2"})}),(0,n.jsx)(w.Z.Item,{tooltip:s("structure_or_format"),label:s("template"),name:["prompt","template"],children:(0,n.jsx)(X,{rows:7,className:"mb-2"})}),(0,n.jsx)(w.Z.Item,{tooltip:s("The_maximum_number_of_tokens"),label:s("max_token"),name:["prompt","max_token"],children:(0,n.jsx)(I.default,{className:"mb-2"})})]})},{key:"Summary",label:(0,n.jsxs)("div",{children:[(0,n.jsx)(Q.Z,{}),s("Summary")]}),children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w.Z.Item,{rules:[{required:!0}],label:s("max_iteration"),name:["summary","max_iteration"],children:(0,n.jsx)(I.default,{className:"mb-2"})}),(0,n.jsx)(w.Z.Item,{rules:[{required:!0}],label:s("concurrency_limit"),name:["summary","concurrency_limit"],children:(0,n.jsx)(I.default,{className:"mb-2"})})]})}],x=async e=>{d(!0);let[,,t]=await (0,r.Vx)((0,r.iH)(l.name,{argument:JSON.stringify(e)}));d(!1),(null==t?void 0:t.success)&&a(!1)};return(0,n.jsx)(b.default,{width:850,open:t,onCancel:()=>{a(!1)},footer:null,children:(0,n.jsx)(Z.Z,{spinning:o,children:(0,n.jsxs)(w.Z,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{...i},autoComplete:"off",onFinish:x,children:[(0,n.jsx)(W.Z,{items:m}),(0,n.jsxs)("div",{className:"mt-3 mb-3",children:[(0,n.jsx)(S.ZP,{htmlType:"submit",type:"primary",className:"mr-6",children:s("Submit")}),(0,n.jsx)(S.ZP,{onClick:()=>{a(!1)},children:s("close")})]})]})})})}var el=t(27595),et=t(27329),ea=t(65886),en=t(68346);function es(e){let{type:l}=e;return"TEXT"===l?(0,n.jsx)(el.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):"DOCUMENT"===l?(0,n.jsx)(et.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):"YUQUEURL"===l?(0,n.jsx)(ea.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):(0,n.jsx)(en.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"})}let{confirm:er}=b.default,ei=e=>{let{name:l,id:t}=e,[a,s]=(0,O.useState)(!1),{t:o}=(0,V.$G)(),d=async(e,l)=>{var t;s(!0);let a=await (0,r.Vx)((0,r.Hx)(e,{doc_ids:[l]}));s(!1),(null===(t=a[2])||void 0===t?void 0:t.success)&&y.ZP.success(o("Synchronization_initiated"))};return a?(0,n.jsx)(Z.Z,{indicator:(0,n.jsx)(i.Z,{spin:!0})}):(0,n.jsxs)(N.Z,{onClick:()=>{d(l,t)},children:[(0,n.jsx)(c.Z,{}),(0,n.jsx)("span",{children:o("Sync")})]})};function ec(e){var l;let[t]=w.Z.useForm(),{space:a,addStatus:s}=e,{t:i}=(0,V.$G)(),c=(0,A.useRouter)(),[q,R]=(0,O.useState)([]),[L,M]=(0,O.useState)([]),[z,G]=(0,O.useState)(!1),[H,$]=(0,O.useState)(0),[J,W]=(0,O.useState)(!1),[B,K]=(0,O.useState)(),[Q,X]=(0,O.useState)(!1),el=(0,O.useRef)(1),et=(0,O.useMemo)(()=>(null==q?void 0:q.length)<H,[q,H]),ea=e=>{er({title:i("Tips"),icon:(0,n.jsx)(o.Z,{}),content:"".concat(i("Del_Document_Tips"),"?"),okText:"Yes",okType:"danger",cancelText:"No",async onOk(){await eu(e)}})},{run:en,refresh:ec,loading:eo}=(0,v.Z)(async()=>await (0,r.Vx)((0,r._Q)(a.name,{page:el.current,page_size:18})),{manual:!0,onSuccess:e=>{let[,l]=e;R(null==l?void 0:l.data),M(null==l?void 0:l.data),$((null==l?void 0:l.total)||0)}}),ed=async()=>{if(!et)return;el.current+=1;let[e,l]=await (0,r.Vx)((0,r._Q)(a.name,{page:el.current,page_size:18}));R([...q,...l.data]),M([...q,...l.data])},eu=async l=>{await (0,r.Vx)((0,r.n3)(a.name,{doc_name:l.doc_name})),en(),e.onDeleteDoc()},em=()=>{e.onAddDoc(a.name)},ex=(e,l)=>{let t;switch(e){case"TODO":t="gold";break;case"RUNNING":t="#2db7f5";break;case"FINISHED":t="cyan";break;default:t="red"}return(0,n.jsx)(k.Z,{title:l,children:(0,n.jsx)(C.Z,{color:t,children:e})})};(0,O.useEffect)(()=>{en()},[]),(0,O.useEffect)(()=>{"finish"===s&&en()},[s]);let{run:eh,loading:ep}=(0,v.Z)(async(e,l)=>{let[,t]=await (0,r.Vx)((0,r.ey)(a.name,{doc_name:l}));return t},{manual:!0,debounceWait:500,onSuccess:e=>{M(null==e?void 0:e.data)}}),{run:ef,loading:ej}=(0,v.Z)(async l=>{var t;return await (0,r.k7)(e.space.name,{questions:null===(t=l.questions)||void 0===t?void 0:t.map(e=>e.question),doc_id:(null==B?void 0:B.id)||"",doc_name:l.doc_name})},{manual:!0,onSuccess:async e=>{e.data.success?(y.ZP.success(i("Edit_Success")),await en(),W(!1)):y.ZP.error(e.data.err_msg)}});return(0,O.useEffect)(()=>{var e;B&&t.setFieldsValue({doc_name:B.doc_name,questions:null===(e=B.questions)||void 0===e?void 0:e.map(e=>({question:e}))})},[B,t]),(0,n.jsxs)("div",{className:"px-4",children:[(0,n.jsxs)(N.Z,{children:[(0,n.jsx)(S.ZP,{size:"middle",type:"primary",className:"flex items-center",icon:(0,n.jsx)(p.Z,{}),onClick:em,children:i("Add_Datasource")}),(0,n.jsx)(S.ZP,{size:"middle",className:"flex items-center mx-2",icon:(0,n.jsx)(f.Z,{}),onClick:()=>{G(!0)},children:"Arguments"}),"KnowledgeGraph"===a.vector_type&&(0,n.jsx)(S.ZP,{size:"middle",className:"flex items-center mx-2",icon:(0,n.jsx)(j.Z,{}),onClick:()=>{c.push("/knowledge/graph/?spaceName=".concat(a.name))},children:i("View_Graph")}),(0,n.jsx)(S.ZP,{icon:(0,n.jsx)(g.Z,{}),onClick:()=>X(!0),children:i("Recall_test")})]}),(0,n.jsx)(F.Z,{}),(0,n.jsx)(Z.Z,{spinning:eo,children:(0,n.jsxs)("div",{className:"w-full h-full",children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)("div",{className:"flex w-full justify-end",children:(0,n.jsx)(S.ZP,{type:"primary",onClick:async()=>{await ec()},loading:eo,children:i("Refresh_status")})})}),(0,n.jsx)("div",{className:"flex flex-col h-full p-3 border rounded-md",children:(null==q?void 0:q.length)>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"flex flex-1 justify-between items-center",children:(0,n.jsx)(I.default,{className:"w-1/3",prefix:(0,n.jsx)(d.Z,{}),placeholder:i("please_enter_the_keywords"),onChange:async e=>{await eh(a.id,e.target.value)},allowClear:!0})}),(0,n.jsxs)(Z.Z,{spinning:ep,children:[(0,n.jsx)(n.Fragment,{children:L.length>0?(0,n.jsx)("div",{className:"h-96 mt-3 grid grid-cols-3 gap-x-6 gap-y-5 overflow-y-auto",children:L.map(e=>(0,n.jsxs)(T.Z,{className:" dark:bg-[#484848] relative  shrink-0 grow-0 cursor-pointer rounded-[10px] border border-gray-200 border-solid w-full max-h-64",title:(0,n.jsx)(k.Z,{title:e.doc_name,children:(0,n.jsxs)("div",{className:"truncate ",children:[(0,n.jsx)(es,{type:e.doc_type}),(0,n.jsx)("span",{children:e.doc_name})]})}),extra:(0,n.jsx)(P.Z,{menu:{items:[{key:"publish",label:(0,n.jsxs)(N.Z,{onClick:()=>{c.push("/construct/knowledge/chunk/?spaceName=".concat(a.name,"&id=").concat(e.id))},children:[(0,n.jsx)(u.Z,{}),(0,n.jsx)("span",{children:i("detail")})]})},{key:"".concat(i("Sync")),label:(0,n.jsx)(ei,{name:a.name,id:e.id})},{key:"edit",label:(0,n.jsxs)(N.Z,{onClick:()=>{W(!0),K(e)},children:[(0,n.jsx)(m.Z,{}),(0,n.jsx)("span",{children:i("Edit")})]})},{key:"del",label:(0,n.jsxs)(N.Z,{onClick:()=>{ea(e)},children:[(0,n.jsx)(x.Z,{}),(0,n.jsx)("span",{children:i("Delete")})]})}]},getPopupContainer:e=>e.parentNode,placement:"bottomRight",autoAdjustOverflow:!1,className:"rounded-md",children:(0,n.jsx)(h.Z,{className:"p-2"})}),children:[(0,n.jsxs)("p",{className:"mt-2 font-semibold ",children:[i("Size"),":"]}),(0,n.jsxs)("p",{children:[e.chunk_size," chunks"]}),(0,n.jsxs)("p",{className:"mt-2 font-semibold ",children:[i("Last_Sync"),":"]}),(0,n.jsx)("p",{children:D()(e.last_sync).format("YYYY-MM-DD HH:MM:SS")}),(0,n.jsx)("p",{className:"mt-2 mb-2",children:ex(e.status,e.result)})]},e.id))}):(0,n.jsx)(E.Z,{className:"flex flex-1 w-full py-10 flex-col items-center justify-center",image:E.Z.PRESENTED_IMAGE_DEFAULT})}),et&&(0,n.jsx)(F.Z,{children:(0,n.jsx)("span",{className:"cursor-pointer",onClick:ed,children:i("Load_more")})})]})]}):(0,n.jsx)(E.Z,{image:E.Z.PRESENTED_IMAGE_DEFAULT,children:(0,n.jsx)(S.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,n.jsx)(p.Z,{}),onClick:em,children:"Create Now"})})})]})}),(0,n.jsx)(ee,{space:a,argumentsShow:z,setArgumentsShow:G}),(0,n.jsx)(b.default,{title:i("Edit_document"),open:J,onCancel:()=>W(!1),destroyOnClose:!0,footer:[(0,n.jsx)(S.ZP,{onClick:()=>W(!1),children:i("cancel")},"back"),(0,n.jsx)(S.ZP,{type:"primary",loading:ej,onClick:async()=>{let e=t.getFieldsValue();await ef(e)},children:i("verify")},"submit")],children:(0,n.jsxs)(w.Z,{form:t,initialValues:{doc_name:null==B?void 0:B.doc_name,questions:null==B?void 0:null===(l=B.questions)||void 0===l?void 0:l.map(e=>({question:e}))},children:[(0,n.jsx)(w.Z.Item,{label:i("Document_name"),name:"doc_name",children:(0,n.jsx)(I.default,{})}),(0,n.jsx)(w.Z.Item,{label:i("Correlation_problem"),children:(0,n.jsx)(w.Z.List,{name:"questions",children:(e,l)=>{let{add:t,remove:a}=l;return(0,n.jsxs)(n.Fragment,{children:[e.map(e=>{let{key:l,name:t}=e;return(0,n.jsxs)("div",{className:U()("flex flex-1 items-center gap-8 mb-6"),children:[(0,n.jsx)(w.Z.Item,{label:"",name:[t,"question"],className:"grow",children:(0,n.jsx)(I.default,{placeholder:"请输入"})}),(0,n.jsx)(w.Z.Item,{children:(0,n.jsx)(_.Z,{onClick:()=>{a(t)}})})]},l)}),(0,n.jsx)(w.Z.Item,{children:(0,n.jsx)(S.ZP,{type:"dashed",onClick:()=>{t({question:"",valid:!1})},block:!0,icon:(0,n.jsx)(p.Z,{}),children:i("Add_problem")})})]})}})})]})}),(0,n.jsx)(Y,{open:Q,setOpen:X,space:a})]})}function eo(e){let{t:l}=(0,V.$G)(),{handleStepChange:t}=e,a=[{type:"TEXT",title:l("Text"),subTitle:l("Fill your raw text"),iconType:"TEXT"},{type:"URL",title:l("URL"),subTitle:l("Fetch_the_content_of_a_URL"),iconType:"WEBPAGE"},{type:"DOCUMENT",title:l("Document"),subTitle:l("Upload_a_document"),iconType:"DOCUMENT"},{type:"YUQUEURL",title:l("yuque"),subTitle:l("Get_yuque_document"),iconType:"YUQUEURL"}];return(0,n.jsx)(n.Fragment,{children:a.map((e,l)=>(0,n.jsxs)(T.Z,{className:"mt-4 mb-4 cursor-pointer",onClick:()=>{t({label:"forward",docType:e.type})},children:[(0,n.jsxs)("div",{className:"font-semibold",children:[(0,n.jsx)(es,{type:e.iconType}),e.title]}),(0,n.jsx)("div",{children:e.subTitle})]},l))})}var ed=t(64082),eu=t(84553),em=t(25593);let{Dragger:ex}=eu.default,{TextArea:eh}=I.default;function ep(e){let{className:l,handleStepChange:t,spaceName:a,docType:s}=e,{t:i}=(0,V.$G)(),[c]=w.Z.useForm(),[o,d]=(0,O.useState)(!1),[u,m]=(0,O.useState)([]),x=async e=>{let l;let{docName:n,textSource:i,text:c,webPageUrl:o,doc_token:m,questions:x=[]}=e;switch(d(!0),s){case"URL":[,l]=await (0,r.Vx)((0,r.H_)(a,{doc_name:n,content:o,doc_type:"URL",questions:null==x?void 0:x.map(e=>e.question)}));break;case"TEXT":[,l]=await (0,r.Vx)((0,r.H_)(a,{doc_name:n,source:i,content:c,doc_type:"TEXT",questions:x.map(e=>e.question)}));break;case"YUQUEURL":[,l]=await (0,r.Vx)((0,r.TT)({doc_name:n,space_name:a,content:o,doc_type:"YUQUEURL",doc_token:m||"",questions:null==x?void 0:x.map(e=>e.question)}))}return(d(!1),"DOCUMENT"===s&&u.length<1)?y.ZP.error("Upload failed, please re-upload."):"DOCUMENT"===s||l?void t({label:"forward",files:"DOCUMENT"===s?u:[{name:n,doc_id:l||-1}]}):y.ZP.error("Upload failed, please re-upload.")},h=e=>{let{fileList:l}=e;0===l.length&&c.setFieldValue("originFileObj",null)},f=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w.Z.Item,{label:"".concat(i("Name"),":"),name:"docName",rules:[{required:!0,message:i("Please_input_the_name")}],children:(0,n.jsx)(I.default,{className:"mb-5 h-12",placeholder:i("Please_input_the_name")})}),(0,n.jsx)(w.Z.Item,{label:"".concat(i("Text_Source"),":"),name:"textSource",rules:[{required:!0,message:i("Please_input_the_text_source")}],children:(0,n.jsx)(I.default,{className:"mb-5  h-12",placeholder:i("Please_input_the_text_source")})}),(0,n.jsx)(w.Z.Item,{label:"".concat(i("Text"),":"),name:"text",rules:[{required:!0,message:i("Please_input_the_description")}],children:(0,n.jsx)(eh,{rows:4})}),(0,n.jsx)(w.Z.Item,{label:"".concat(i("Correlation_problem"),":"),children:(0,n.jsx)(w.Z.List,{name:"questions",children:(e,l)=>{let{add:t,remove:a}=l;return(0,n.jsxs)(n.Fragment,{children:[e.map(e=>{let{key:l,name:t}=e;return(0,n.jsxs)("div",{className:U()("flex flex-1 items-center gap-8 mb-6"),children:[(0,n.jsx)(w.Z.Item,{label:"",name:[t,"question"],className:"grow",children:(0,n.jsx)(I.default,{placeholder:i("input_question")})}),(0,n.jsx)(w.Z.Item,{children:(0,n.jsx)(_.Z,{onClick:()=>{a(t)}})})]},l)}),(0,n.jsx)(w.Z.Item,{children:(0,n.jsx)(S.ZP,{type:"dashed",onClick:()=>{t()},block:!0,icon:(0,n.jsx)(p.Z,{}),children:i("Add_problem")})})]})}})})]}),j=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w.Z.Item,{label:"".concat(i("Name"),":"),name:"docName",rules:[{required:!0,message:i("Please_input_the_name")}],children:(0,n.jsx)(I.default,{className:"mb-5 h-12",placeholder:i("Please_input_the_name")})}),(0,n.jsx)(w.Z.Item,{label:"".concat(i("Web_Page_URL"),":"),name:"webPageUrl",rules:[{required:!0,message:i("Please_input_the_Web_Page_URL")}],children:(0,n.jsx)(I.default,{className:"mb-5  h-12",placeholder:i("Please_input_the_Web_Page_URL")})}),(0,n.jsx)(w.Z.Item,{label:"".concat(i("Correlation_problem"),":"),children:(0,n.jsx)(w.Z.List,{name:"questions",children:(e,l)=>{let{add:t,remove:a}=l;return(0,n.jsxs)(n.Fragment,{children:[e.map(e=>{let{key:l,name:t}=e;return(0,n.jsxs)("div",{className:U()("flex flex-1 items-center gap-8 mb-6"),children:[(0,n.jsx)(w.Z.Item,{label:"",name:[t,"question"],className:"grow",children:(0,n.jsx)(I.default,{placeholder:i("input_question")})}),(0,n.jsx)(w.Z.Item,{children:(0,n.jsx)(_.Z,{onClick:()=>{a(t)}})})]},l)}),(0,n.jsx)(w.Z.Item,{children:(0,n.jsx)(S.ZP,{type:"dashed",onClick:()=>{t()},block:!0,icon:(0,n.jsx)(p.Z,{}),children:i("Add_problem")})})]})}})})]}),g=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w.Z.Item,{label:"".concat(i("Name"),":"),name:"docName",rules:[{required:!0,message:i("Please_input_the_name")}],children:(0,n.jsx)(I.default,{className:"mb-5 h-12",placeholder:i("Please_input_the_name")})}),(0,n.jsx)(w.Z.Item,{label:i("document_url"),name:"webPageUrl",rules:[{required:!0,message:i("input_document_url")}],children:(0,n.jsx)(I.default,{className:"mb-5  h-12",placeholder:i("input_document_url")})}),(0,n.jsx)(w.Z.Item,{label:i("document_token"),name:"doc_token",tooltip:(0,n.jsxs)(n.Fragment,{children:[i("Get_token"),(0,n.jsx)(em.Z.Link,{href:"",target:"_blank",children:i("Reference_link")})]}),children:(0,n.jsx)(I.default,{className:"mb-5  h-12",placeholder:i("input_document_token")})}),(0,n.jsx)(w.Z.Item,{label:"".concat(i("Correlation_problem"),":"),children:(0,n.jsx)(w.Z.List,{name:"questions",children:(e,l)=>{let{add:t,remove:a}=l;return(0,n.jsxs)(n.Fragment,{children:[e.map(e=>{let{key:l,name:t}=e;return(0,n.jsxs)("div",{className:U()("flex flex-1 items-center gap-8 mb-6"),children:[(0,n.jsx)(w.Z.Item,{label:"",name:[t,"question"],className:"grow",children:(0,n.jsx)(I.default,{placeholder:i("input_question")})}),(0,n.jsx)(w.Z.Item,{children:(0,n.jsx)(_.Z,{onClick:()=>{a(t)}})})]},l)}),(0,n.jsx)(w.Z.Item,{children:(0,n.jsx)(S.ZP,{type:"dashed",onClick:()=>{t()},block:!0,icon:(0,n.jsx)(p.Z,{}),children:i("Add_problem")})})]})}})})]}),v=async e=>{let{onSuccess:l,onError:t,file:n}=e,s=new FormData,i=null==n?void 0:n.name;s.append("doc_name",i),s.append("doc_file",n),s.append("doc_type","DOCUMENT");let[,c]=await (0,r.Vx)((0,r.iG)(a,s));Number.isInteger(c)?(l&&l(c||0),m(e=>(e.push({name:i,doc_id:c||-1}),e))):t&&t({name:"",message:""})},b=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w.Z.Item,{name:"originFileObj",rules:[{required:!0,message:i("Please_select_file")}],children:(0,n.jsxs)(ex,{multiple:!0,onChange:h,maxCount:100,accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md,.zip,.csv",customRequest:v,children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(ed.Z,{})}),(0,n.jsx)("p",{style:{color:"rgb(22, 108, 255)",fontSize:"20px"},children:i("Select_or_Drop_file")}),(0,n.jsx)("p",{className:"ant-upload-hint",style:{color:"rgb(22, 108, 255)"},children:"PDF, PowerPoint, Excel, Word, Text, Markdown, Zip1, Csv"})]})}),(0,n.jsx)(w.Z.Item,{label:"关联问题:",children:(0,n.jsx)(w.Z.List,{name:"questions",children:(e,l)=>{let{add:t,remove:a}=l;return(0,n.jsxs)(n.Fragment,{children:[e.map(e=>{let{key:l,name:t}=e;return(0,n.jsxs)("div",{className:U()("flex flex-1 items-center gap-8 mb-6"),children:[(0,n.jsx)(w.Z.Item,{label:"",name:[t,"question"],className:"grow",children:(0,n.jsx)(I.default,{placeholder:"请输入问题"})}),(0,n.jsx)(w.Z.Item,{children:(0,n.jsx)(_.Z,{onClick:()=>{a(t)}})})]},l)}),(0,n.jsx)(w.Z.Item,{children:(0,n.jsx)(S.ZP,{type:"dashed",onClick:()=>{t()},block:!0,icon:(0,n.jsx)(p.Z,{}),children:i("Add_problem")})})]})}})})]});return(0,n.jsx)(Z.Z,{spinning:o,children:(0,n.jsxs)(w.Z,{form:c,size:"large",className:U()("mt-4",l),layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:x,children:[(()=>{switch(s){case"URL":return j();case"DOCUMENT":return b();case"YUQUEURL":return g();default:return f()}})(),(0,n.jsxs)(w.Z.Item,{children:[(0,n.jsx)(S.ZP,{onClick:()=>{t({label:"back"})},className:"mr-4",children:"".concat(i("Back"))}),(0,n.jsx)(S.ZP,{type:"primary",loading:o,htmlType:"submit",children:i("Next")})]})]})})}var ef=t(82353),ej=t(16165),eg=t(38925),e_=t(47221),ev=t(84567),eb=t(78045);let{TextArea:ey}=I.default;function eZ(e){let{strategies:l,docType:t,fileName:a,field:s}=e,[r,i]=(0,O.useState)(),c="";if("DOCUMENT"===t){let e=a.split(".");c=e[e.length-1]}let o=c?l.filter(e=>e.suffix.indexOf(c)>-1):l,{t:d}=(0,V.$G)(),u={strategy:"Automatic",name:d("Automatic"),desc:d("Automatic_desc")};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w.Z.Item,{name:[s.name,"chunk_parameters","chunk_strategy"],initialValue:u.strategy,children:(0,n.jsxs)(eb.ZP.Group,{style:{marginTop:16},onChange:function(e){i(e.target.value)},children:[(0,n.jsx)(eb.ZP,{value:u.strategy,children:u.name}),o.map(e=>(0,n.jsx)(eb.ZP,{value:e.strategy,children:e.name},"strategy_radio_".concat(e.strategy)))]})}),function(){var e;if(!r)return null;if(r===u.name)return(0,n.jsx)("p",{className:"my-4",children:u.desc});let l=null===(e=null==o?void 0:o.filter(e=>e.strategy===r)[0])||void 0===e?void 0:e.parameters;return l&&l.length?(0,n.jsx)("div",{className:"mt-2",children:null==l?void 0:l.map(e=>(0,n.jsx)(w.Z.Item,{label:e.param_name,name:[s.name,"chunk_parameters",e.param_name],rules:[{required:!0,message:d("Please_input_the_name")}],initialValue:e.default_value,valuePropName:"boolean"===e.param_type?"checked":"value",tooltip:e.description,children:function(e){switch(e){case"int":return(0,n.jsx)(G.Z,{className:"w-full",min:1});case"string":return(0,n.jsx)(ey,{className:"w-full",rows:2});case"boolean":return(0,n.jsx)(ev.Z,{})}}(e.param_type)},"param_".concat(e.param_name)))}):(0,n.jsx)(eg.Z,{className:"my-2",type:"warning",message:d("No_parameter")})}()]})}function eN(e){let{spaceName:l,docType:t,uploadFiles:s,handleStepChange:i}=e,{t:c}=(0,V.$G)(),[o]=w.Z.useForm(),[d,u]=(0,O.useState)(s),[m,x]=(0,O.useState)(),[h,p]=(0,O.useState)([]),[f,j]=(0,O.useState)("");async function g(){var e;x(!0);let[,l]=await (0,r.Vx)((0,r.iZ)());x(!1),p(null===(e=l||[])||void 0===e?void 0:e.filter(e=>e.type.indexOf(t)>-1))}(0,O.useEffect)(()=>(g(),()=>{a&&clearInterval(a)}),[]);let _=async e=>{if(function(e){let l=!0;"RUNNING"===f&&(l=!1,y.ZP.warning("The task is still running, do not submit it again."));let{fileStrategies:t}=e;return t.map(e=>{var t,a;let n=(null==e?void 0:null===(t=e.chunk_parameters)||void 0===t?void 0:t.chunk_strategy)||"Automatic";n||(y.ZP.error("Please select chunk strategy for ".concat(e.name,".")),l=!1);let s=h.filter(e=>e.strategy===n)[0],r={chunk_strategy:(null==e?void 0:null===(a=e.chunk_parameters)||void 0===a?void 0:a.chunk_strategy)||"Automatic"};s&&s.parameters&&s.parameters.forEach(l=>{let t=l.param_name;r[t]=(null==e?void 0:e.chunk_parameters)[t]}),e.chunk_parameters=r}),l}(e)){var t;x(!0);let[,n]=await (0,r.Vx)((0,r.KL)(l,e.fileStrategies));if(x(!1),(null==n?void 0:n.tasks)&&(null==n?void 0:null===(t=n.tasks)||void 0===t?void 0:t.length)>0){y.ZP.success("Segemation task start successfully. task id: ".concat(null==n?void 0:n.tasks.join(","))),j("RUNNING");let l=e.fileStrategies.map(e=>e.doc_id);a=setInterval(async()=>{let e=await v(l);"FINISHED"===e?(clearInterval(a),j("FINISHED"),y.ZP.success("Congratulation, All files sync successfully."),i({label:"finish"})):"FAILED"===e&&(clearInterval(a),i({label:"finish"}))},3e3)}}};async function v(e){let[,t]=await (0,r.Vx)((0,r._Q)(l,{doc_ids:e}));if((null==t?void 0:t.data)&&(null==t?void 0:t.data.length)>0){let e=[...d];if(null==t||t.data.map(l=>{var t;let a=null===(t=null==e?void 0:e.filter(e=>e.doc_id===l.id))||void 0===t?void 0:t[0];a&&(a.status=l.status)}),u(e),null==t?void 0:t.data.every(e=>"FINISHED"===e.status||"FAILED"===e.status))return"FINISHED"}}return(0,n.jsx)(Z.Z,{spinning:m,children:(0,n.jsxs)(w.Z,{labelCol:{span:6},wrapperCol:{span:18},labelAlign:"right",form:o,size:"large",className:"mt-4",layout:"horizontal",name:"basic",autoComplete:"off",initialValues:{fileStrategies:d},onFinish:_,children:[h&&h.length?(0,n.jsx)(w.Z.List,{name:"fileStrategies",children:e=>{switch(t){case"TEXT":case"URL":case"YUQUEURL":return null==e?void 0:e.map(e=>(0,n.jsx)(eZ,{strategies:h,docType:t,fileName:d[e.name].name,field:e},e.key));case"DOCUMENT":return(0,n.jsx)(e_.Z,{defaultActiveKey:0,size:d.length>5?"small":"middle",children:null==e?void 0:e.map(e=>(0,n.jsx)(e_.Z.Panel,{header:"".concat(e.name+1,". ").concat(d[e.name].name),extra:function(e){let l=d[e].status;switch(l){case"FINISHED":return(0,n.jsx)(ej.Z,{component:ef.qw});case"RUNNING":return(0,n.jsx)(ej.Z,{className:"animate-spin animate-infinite",component:ef.bn});case"FAILED":return(0,n.jsx)(ej.Z,{component:ef.FE});default:return(0,n.jsx)(ej.Z,{component:ef.tu})}}(e.name),children:(0,n.jsx)(eZ,{strategies:h,docType:t,fileName:d[e.name].name,field:e})},e.key))})}}}):(0,n.jsx)(eg.Z,{message:"Cannot find one strategy for ".concat(t," type knowledge."),type:"warning"}),(0,n.jsxs)(w.Z.Item,{className:"mt-4",children:[(0,n.jsx)(S.ZP,{onClick:()=>{i({label:"back"})},className:"mr-4",children:"".concat(c("Back"))}),(0,n.jsx)(S.ZP,{type:"primary",htmlType:"submit",loading:m||"RUNNING"===f,children:c("Process")})]})]})})}function ew(e){var l;let{t}=(0,V.$G)(),{handleStepChange:a,spaceConfig:s}=e,[i,c]=(0,O.useState)(!1),[o,d]=(0,O.useState)(),[u]=w.Z.useForm();(0,O.useEffect)(()=>{u.setFieldValue("storage",null==s?void 0:s[0].name),d(null==s?void 0:s[0].name)},[s]);let m=async e=>{let{spaceName:l,owner:t,description:n,storage:s,field:i}=e;c(!0);let[o,d,u]=await (0,r.Vx)((0,r.be)({name:l,vector_type:s,owner:t,desc:n,domain_type:i}));c(!1);let m="FinancialReport"===i;localStorage.setItem("cur_space_id",JSON.stringify(d)),(null==u?void 0:u.success)&&a({label:"forward",spaceName:l,pace:m?2:1,docType:m?"DOCUMENT":""})};return(0,n.jsx)(Z.Z,{spinning:i,children:(0,n.jsxs)(w.Z,{form:u,size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:m,children:[(0,n.jsx)(w.Z.Item,{label:t("Knowledge_Space_Name"),name:"spaceName",rules:[{required:!0,message:t("Please_input_the_name")},()=>({validator:(e,l)=>/[^\u4e00-\u9fa50-9a-zA-Z_-]/.test(l)?Promise.reject(Error(t("the_name_can_only_contain"))):Promise.resolve()})],children:(0,n.jsx)(I.default,{className:"h-12",placeholder:t("Please_input_the_name")})}),(0,n.jsx)(w.Z.Item,{label:t("Storage"),name:"storage",rules:[{required:!0,message:t("Please_select_the_storage")}],children:(0,n.jsx)(H.default,{className:"mb-5 h-12",placeholder:t("Please_select_the_storage"),onChange:e=>{d(e)},children:null==s?void 0:s.map(e=>(0,n.jsx)(H.default.Option,{value:e.name,children:e.desc},e.name))})}),(0,n.jsx)(w.Z.Item,{label:t("Domain"),name:"field",rules:[{required:!0,message:t("Please_select_the_domain_type")}],children:(0,n.jsx)(H.default,{className:"mb-5 h-12",placeholder:t("Please_select_the_domain_type"),children:null===(l=null==s?void 0:s.find(e=>e.name===o))||void 0===l?void 0:l.domain_types.map(e=>(0,n.jsx)(H.default.Option,{value:e.name,children:e.desc},e.name))})}),(0,n.jsx)(w.Z.Item,{label:t("Description"),name:"description",rules:[{required:!0,message:t("Please_input_the_description")}],children:(0,n.jsx)(I.default,{className:"h-12",placeholder:t("Please_input_the_description")})}),(0,n.jsx)(w.Z.Item,{children:(0,n.jsx)(S.ZP,{type:"primary",htmlType:"submit",children:t("Next")})})]})})}var ek=t(91467),eC=t(14079),eS=t(42119),eI=t(96486),eT=()=>{let{setCurrentDialogInfo:e}=(0,O.useContext)(s.p),[l,t]=(0,O.useState)([]),[a,i]=(0,O.useState)(!1),[c,u]=(0,O.useState)(!1),[m,x]=(0,O.useState)(),[h,f]=(0,O.useState)(0),[j,g]=(0,O.useState)(""),[_,v]=(0,O.useState)([]),[y,N]=(0,O.useState)(""),[w,k]=(0,O.useState)(""),[T,P]=(0,O.useState)(!1),[E,F]=(0,O.useState)(null),{t:q}=(0,V.$G)(),R=[{title:q("Knowledge_Space_Config")},{title:q("Choose_a_Datasource_type")},{title:q("Upload")},{title:q("Segmentation")}],L=(0,A.useRouter)();async function M(e){P(!0);let[l,a]=await (0,r.Vx)((0,r.Vm)({...e}));P(!1),t(a)}async function z(){let[e,l]=await (0,r.Vx)((0,r.mB)());if(!l)return null;F(l.storage)}(0,O.useEffect)(()=>{M(),z()},[]);let G=async l=>{let[t,a]=await (0,r.Vx)((0,r.sW)({chat_mode:"chat_knowledge"}));(null==a?void 0:a.conv_uid)&&(null==e||e({chat_scene:a.chat_mode,app_code:a.chat_mode}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:a.chat_mode,app_code:a.chat_mode})),L.push("/chat?scene=chat_knowledge&id=".concat(null==a?void 0:a.conv_uid,"&knowledge_id=").concat(l.name)))},H=e=>{let{label:l,spaceName:t,docType:a,files:n}=e;"finish"===l?(i(!1),M(),g(""),N(""),k("finish"),localStorage.removeItem("cur_space_id")):"forward"===l?(0===h&&M(),f(e=>e+1)):f(e=>e-1),n&&v(n),t&&g(t),a&&N(a)},Y=e=>{b.default.confirm({title:q("Tips"),icon:(0,n.jsx)(o.Z,{}),content:"".concat(q("Del_Knowledge_Tips"),"?"),okText:"Yes",okType:"danger",cancelText:"No",async onOk(){await (0,r.Vx)((0,r.XK)({name:null==e?void 0:e.name})),M()}})},$=async e=>{M({name:e.target.value})};return(0,n.jsxs)(Z.Z,{spinning:T,children:[(0,n.jsxs)("div",{className:"page-body p-4 md:p-6 h-[90vh] overflow-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("div",{className:"flex items-center gap-4",children:(0,n.jsx)(I.default,{variant:"filled",prefix:(0,n.jsx)(d.Z,{}),placeholder:q("please_enter_the_keywords"),onChange:(0,eI.debounce)($,300),allowClear:!0,className:"w-[230px] h-[40px] border-1 border-white backdrop-filter backdrop-blur-lg bg-white bg-opacity-30 dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60"})}),(0,n.jsx)("div",{className:"flex items-center gap-4",children:(0,n.jsx)(S.ZP,{className:"border-none bg-button-gradient",icon:(0,n.jsx)(p.Z,{}),onClick:()=>{i(!0)},children:q("create_knowledge")})})]}),(0,n.jsx)("div",{className:"flex flex-wrap mt-4 mx-[-8px]",children:null==l?void 0:l.map(e=>(0,n.jsx)(ek.ZP,{onClick:()=>{x(e),u(!0),localStorage.setItem("cur_space_id",JSON.stringify(e.id))},description:e.desc,name:e.name,logo:"FinancialReport"===e.domain_type?"/models/fin_report.jpg":"KnowledgeGraph"===e.vector_type?"/models/knowledge-graph.png":"FullText"===e.vector_type?"/models/knowledge-full-text.jpg":"/models/knowledge-default.jpg",RightTop:(0,n.jsx)(ek.ZS,{menu:{items:[{key:"del",label:(0,n.jsx)("span",{className:"text-red-400",onClick:()=>Y(e),children:q("Delete")})}]}}),rightTopHover:!1,Tags:(0,n.jsxs)("div",{className:"flex item-center",children:[(0,n.jsx)(C.Z,{children:(0,n.jsxs)("span",{className:"flex items-center gap-1",children:[(0,n.jsx)(eC.Z,{className:"mt-[1px]"}),e.docs]})}),(0,n.jsx)(C.Z,{children:(0,n.jsx)("span",{className:"flex items-center gap-1",children:e.domain_type||"Normal"})}),e.vector_type?(0,n.jsx)(C.Z,{children:(0,n.jsx)("span",{className:"flex items-center gap-1",children:e.vector_type})}):null]}),LeftBottom:(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("span",{children:e.owner}),(0,n.jsx)("span",{children:"•"}),(null==e?void 0:e.gmt_modified)&&(0,n.jsx)("span",{children:D()(null==e?void 0:e.gmt_modified).fromNow()+" "+q("update")})]}),RightBottom:(0,n.jsx)(ek.TH,{text:q("start_chat"),onClick:()=>{G(e)}})},e.id))})]}),(0,n.jsx)(b.default,{className:"h-5/6 overflow-hidden",open:c,width:"70%",onCancel:()=>u(!1),footer:null,destroyOnClose:!0,children:(0,n.jsx)(ec,{space:m,onAddDoc:function(e){g(e),f(1),i(!0),k("start")},onDeleteDoc:M,addStatus:w})}),(0,n.jsxs)(b.default,{title:q("New_knowledge_base"),centered:!0,open:a,destroyOnClose:!0,onCancel:()=>{i(!1)},width:1e3,afterClose:()=>{f(0),M()},footer:null,children:[(0,n.jsx)(eS.Z,{current:h,items:R}),0===h&&(0,n.jsx)(ew,{handleStepChange:H,spaceConfig:E}),1===h&&(0,n.jsx)(eo,{handleStepChange:H}),(0,n.jsx)(ep,{className:U()({hidden:2!==h}),spaceName:j,docType:y,handleStepChange:H}),3===h&&(0,n.jsx)(eN,{spaceName:j,docType:y,uploadFiles:_,handleStepChange:H})]})]})}},56397:function(e,l,t){"use strict";t.r(l);var a=t(85893),n=t(48218),s=t(58638),r=t(36447),i=t(25593),c=t(20640),o=t.n(c),d=t(67294),u=t(23820);l.default=(0,d.memo)(()=>{var e;let{appInfo:l}=(0,d.useContext)(u.MobileChatContext),{message:t}=r.Z.useApp(),[c,m]=(0,d.useState)(0);if(!(null==l?void 0:l.app_code))return null;let x=async()=>{let e=o()("dingtalk://dingtalkclient/page/link?url=".concat(encodeURIComponent(location.href),"&pc_slide=true"));t[e?"success":"error"](e?"复制成功":"复制失败")};return c>6&&t.info(JSON.stringify(window.navigator.userAgent),2,()=>{m(0)}),(0,a.jsxs)("header",{className:"flex w-full items-center justify-between bg-[rgba(255,255,255,0.9)] border dark:bg-black dark:border-[rgba(255,255,255,0.6)] rounded-xl mx-auto px-4 py-2 mb-4 sticky top-4 z-50 mt-4 shadow-md",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",onClick:()=>m(c+1),children:[(0,a.jsx)(n.Z,{scene:(null==l?void 0:null===(e=l.team_context)||void 0===e?void 0:e.chat_scene)||"chat_agent",width:8,height:8}),(0,a.jsxs)("div",{className:"flex flex-col ml-2",children:[(0,a.jsx)(i.Z.Text,{className:"text-md font-bold line-clamp-2",children:null==l?void 0:l.app_name}),(0,a.jsx)(i.Z.Text,{className:"text-sm line-clamp-2",children:null==l?void 0:l.app_describe})]})]}),(0,a.jsx)("div",{onClick:x,className:"flex items-center justify-center w-10 h-10 bg-[#ffffff99] dark:bg-[rgba(255,255,255,0.2)] border border-white dark:border-[rgba(255,255,255,0.2)] rounded-[50%] cursor-pointer",children:(0,a.jsx)(s.Z,{className:"text-lg"})})]})})},74638:function(e,l,t){"use strict";t.r(l);var a=t(85893),n=t(60778),s=t(62418),r=t(25519),i=t(30159),c=t(87740),o=t(50888),d=t(52645),u=t(27496),m=t(1375),x=t(65654),h=t(66309),p=t(55241),f=t(74330),j=t(38289),g=t(77683),_=t(93967),v=t.n(_),b=t(39332),y=t(67294),Z=t(23820),N=t(7001),w=t(73749),k=t(97109),C=t(83454);let S=["magenta","orange","geekblue","purple","cyan","green"];l.default=()=>{var e,l;let t=(0,b.useSearchParams)(),_=null!==(l=null==t?void 0:t.get("ques"))&&void 0!==l?l:"",{history:I,model:T,scene:P,temperature:E,resource:F,conv_uid:q,appInfo:U,scrollViewRef:R,order:D,userInput:A,ctrl:O,canAbort:V,canNewChat:L,setHistory:M,setCanNewChat:z,setCarAbort:G,setUserInput:H}=(0,y.useContext)(Z.MobileChatContext),[Y,$]=(0,y.useState)(!1),[J,W]=(0,y.useState)(!1),B=async e=>{var l,t,a;H(""),O.current=new AbortController;let n={chat_mode:P,model_name:T,user_input:e||A,conv_uid:q,temperature:E,app_code:null==U?void 0:U.app_code,...F&&{select_param:JSON.stringify(F)}};if(I&&I.length>0){let e=null==I?void 0:I.filter(e=>"view"===e.role);D.current=e[e.length-1].order+1}let i=[{role:"human",context:e||A,model_name:T,order:D.current,time_stamp:0},{role:"view",context:"",model_name:T,order:D.current,time_stamp:0,thinking:!0}],c=i.length-1;M([...I,...i]),z(!1);try{await (0,m.L)("".concat(null!==(l=C.env.API_BASE_URL)&&void 0!==l?l:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[r.gp]:null!==(t=(0,s.n5)())&&void 0!==t?t:""},signal:O.current.signal,body:JSON.stringify(n),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===m.a)return},onclose(){var e;null===(e=O.current)||void 0===e||e.abort(),z(!0),G(!1)},onerror(e){throw Error(e)},onmessage:e=>{let l=e.data;try{l=JSON.parse(l).vis}catch(e){l.replaceAll("\\n","\n")}"[DONE]"===l?(z(!0),G(!1)):(null==l?void 0:l.startsWith("[ERROR]"))?(i[c].context=null==l?void 0:l.replace("[ERROR]",""),i[c].thinking=!1,M([...I,...i]),z(!0),G(!1)):(G(!0),i[c].context=l,i[c].thinking=!1,M([...I,...i]))}})}catch(e){null===(a=O.current)||void 0===a||a.abort(),i[c].context="Sorry, we meet some error, please try again later.",i[c].thinking=!1,M([...i]),z(!0),G(!1)}},K=async()=>{A.trim()&&L&&await B()};(0,y.useEffect)(()=>{var e,l;null===(e=R.current)||void 0===e||e.scrollTo({top:null===(l=R.current)||void 0===l?void 0:l.scrollHeight,behavior:"auto"})},[I,R]);let Q=(0,y.useMemo)(()=>{if(!U)return[];let{param_need:e=[]}=U;return null==e?void 0:e.map(e=>e.type)},[U]),X=(0,y.useMemo)(()=>{var e;return 0===I.length&&U&&!!(null==U?void 0:null===(e=U.recommend_questions)||void 0===e?void 0:e.length)},[I,U]),{run:ee,loading:el}=(0,x.Z)(async()=>await (0,n.Vx)((0,n.zR)(q)),{manual:!0,onSuccess:()=>{M([])}});return(0,y.useEffect)(()=>{_&&T&&q&&U&&B(_)},[U,q,T,_]),(0,a.jsxs)("div",{className:"flex flex-col",children:[X&&(0,a.jsx)("ul",{children:null==U?void 0:null===(e=U.recommend_questions)||void 0===e?void 0:e.map((e,l)=>(0,a.jsx)("li",{className:"mb-3",children:(0,a.jsx)(h.Z,{color:S[l],className:"p-2 rounded-xl",onClick:async()=>{B(e.question)},children:e.question})},e.id))}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,a.jsxs)("div",{className:"flex gap-2 mb-1 w-full overflow-x-auto",children:[(null==Q?void 0:Q.includes("model"))&&(0,a.jsx)(N.default,{}),(null==Q?void 0:Q.includes("resource"))&&(0,a.jsx)(w.default,{}),(null==Q?void 0:Q.includes("temperature"))&&(0,a.jsx)(k.default,{})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-lg font-bold",children:[(0,a.jsx)(p.Z,{content:"暂停回复",trigger:["hover"],children:(0,a.jsx)(i.Z,{className:v()("p-2 cursor-pointer",{"text-[#0c75fc]":V,"text-gray-400":!V}),onClick:()=>{var e;V&&(null===(e=O.current)||void 0===e||e.abort(),setTimeout(()=>{G(!1),z(!0)},100))}})}),(0,a.jsx)(p.Z,{content:"再来一次",trigger:["hover"],children:(0,a.jsx)(c.Z,{className:v()("p-2 cursor-pointer",{"text-gray-400":!I.length||!L}),onClick:()=>{var e,l;if(!L||0===I.length)return;let t=null===(e=null===(l=I.filter(e=>"human"===e.role))||void 0===l?void 0:l.slice(-1))||void 0===e?void 0:e[0];B((null==t?void 0:t.context)||"")}})}),el?(0,a.jsx)(f.Z,{spinning:el,indicator:(0,a.jsx)(o.Z,{style:{fontSize:18},spin:!0}),className:"p-2"}):(0,a.jsx)(p.Z,{content:"清除历史",trigger:["hover"],children:(0,a.jsx)(d.Z,{className:v()("p-2 cursor-pointer",{"text-gray-400":!I.length||!L}),onClick:()=>{L&&ee()}})})]})]}),(0,a.jsxs)("div",{className:v()("flex py-2 px-3 items-center justify-between bg-white dark:bg-[#242733] dark:border-[#6f7f95] rounded-xl border",{"border-[#0c75fc] dark:border-[rgba(12,117,252,0.8)]":Y}),children:[(0,a.jsx)(j.default.TextArea,{placeholder:"可以问我任何问题",className:"w-full resize-none border-0 p-0 focus:shadow-none",value:A,autoSize:{minRows:1},onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey){if(J){e.preventDefault();return}A.trim()&&(e.preventDefault(),K())}},onChange:e=>{H(e.target.value)},onFocus:()=>{$(!0)},onBlur:()=>$(!1),onCompositionStartCapture:()=>{W(!0)},onCompositionEndCapture:()=>{setTimeout(()=>{W(!1)},0)}}),(0,a.jsx)(g.ZP,{type:"primary",className:v()("flex items-center justify-center rounded-lg bg-button-gradient border-0 ml-2",{"opacity-40 cursor-not-allowed":!A.trim()||!L}),onClick:K,children:L?(0,a.jsx)(u.Z,{}):(0,a.jsx)(f.Z,{indicator:(0,a.jsx)(o.Z,{className:"text-white"})})})]})]})}},7001:function(e,l,t){"use strict";t.r(l);var a=t(85893),n=t(41468),s=t(39718),r=t(94668),i=t(85418),c=t(55241),o=t(67294),d=t(23820);l.default=()=>{let{modelList:e}=(0,o.useContext)(n.p),{model:l,setModel:t}=(0,o.useContext)(d.MobileChatContext),u=(0,o.useMemo)(()=>e.length>0?e.map(e=>({label:(0,a.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{t(e)},children:[(0,a.jsx)(s.Z,{width:14,height:14,model:e}),(0,a.jsx)("span",{className:"text-xs",children:e})]}),key:e})):[],[e,t]);return(0,a.jsx)(i.Z,{menu:{items:u},placement:"top",trigger:["click"],children:(0,a.jsx)(c.Z,{content:l,children:(0,a.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,a.jsx)(s.Z,{width:16,height:16,model:l}),(0,a.jsx)("span",{className:"text-xs font-medium line-clamp-1",style:{maxWidth:96},children:l}),(0,a.jsx)(r.Z,{rotate:90})]})})})}},46568:function(e,l,t){"use strict";t.r(l);var a=t(85893),n=t(25675),s=t.n(n),r=t(67294);l.default=(0,r.memo)(e=>{let{width:l,height:t,src:n,label:r}=e;return(0,a.jsx)(s(),{width:l||14,height:t||14,src:n,alt:r||"db-icon",priority:!0})})},73749:function(e,l,t){"use strict";t.r(l);var a=t(85893),n=t(60778),s=t(16520),r=t(62418),i=t(50888),c=t(94668),o=t(83266),d=t(65654),u=t(74330),m=t(84553),x=t(85418),h=t(67294),p=t(23820),f=t(46568);l.default=()=>{let{appInfo:e,resourceList:l,scene:t,model:j,conv_uid:g,getChatHistoryRun:_,setResource:v,resource:b}=(0,h.useContext)(p.MobileChatContext),{temperatureValue:y,maxNewTokensValue:Z}=(0,h.useContext)(s.ChatContentContext),[N,w]=(0,h.useState)(null),k=(0,h.useMemo)(()=>{var l,t,a;return null===(l=null==e?void 0:null===(t=e.param_need)||void 0===t?void 0:t.filter(e=>"resource"===e.type))||void 0===l?void 0:null===(a=l[0])||void 0===a?void 0:a.value},[e]),C=(0,h.useMemo)(()=>l&&l.length>0?l.map(e=>({label:(0,a.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{w(e),v(e.space_id||e.param)},children:[(0,a.jsx)(f.default,{width:14,height:14,src:r.S$[e.type].icon,label:r.S$[e.type].label}),(0,a.jsx)("span",{className:"text-xs",children:e.param})]}),key:e.space_id||e.param})):[],[l,v]),{run:S,loading:I}=(0,d.Z)(async e=>{let[,l]=await (0,n.Vx)((0,n.qn)({convUid:g,chatMode:t,data:e,model:j,temperatureValue:y,maxNewTokensValue:Z,config:{timeout:36e5}}));return v(l),l},{manual:!0,onSuccess:async()=>{await _()}}),T=async e=>{let l=new FormData;l.append("doc_file",null==e?void 0:e.file),await S(l)},P=(0,h.useMemo)(()=>I?(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(u.Z,{size:"small",indicator:(0,a.jsx)(i.Z,{spin:!0})}),(0,a.jsx)("span",{className:"text-xs",children:"上传中"})]}):b?(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)("span",{className:"text-xs",children:b.file_name}),(0,a.jsx)(c.Z,{rotate:90})]}):(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(o.Z,{className:"text-base"}),(0,a.jsx)("span",{className:"text-xs",children:"上传文件"})]}),[I,b]);return(0,a.jsx)(a.Fragment,{children:(()=>{switch(k){case"excel_file":case"text_file":case"image_file":return(0,a.jsx)("div",{className:"flex items-center justify-center gap-1 border rounded-xl bg-white dark:bg-black px-2 flex-shrink-0",children:(0,a.jsx)(m.default,{name:"file",accept:".xlsx,.xls",maxCount:1,showUploadList:!1,beforeUpload:()=>!1,onChange:T,className:"flex h-full w-full items-center justify-center",children:P})});case"database":case"knowledge":case"plugin":case"awel_flow":var e,t,n,s,i;if(!(null==l?void 0:l.length))return null;return(0,a.jsx)(x.Z,{menu:{items:C},placement:"top",trigger:["click"],children:(0,a.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,a.jsx)(f.default,{width:14,height:14,src:null===(e=r.S$[(null==N?void 0:N.type)||(null==l?void 0:null===(t=l[0])||void 0===t?void 0:t.type)])||void 0===e?void 0:e.icon,label:null===(n=r.S$[(null==N?void 0:N.type)||(null==l?void 0:null===(s=l[0])||void 0===s?void 0:s.type)])||void 0===n?void 0:n.label}),(0,a.jsx)("span",{className:"text-xs font-medium",children:(null==N?void 0:N.param)||(null==l?void 0:null===(i=l[0])||void 0===i?void 0:i.param)}),(0,a.jsx)(c.Z,{rotate:90})]})})}})()})}},97109:function(e,l,t){"use strict";t.r(l);var a=t(85893),n=t(70065),s=t(85418),r=t(30568),i=t(67294),c=t(23820);l.default=()=>{let{temperature:e,setTemperature:l}=(0,i.useContext)(c.MobileChatContext),t=e=>{isNaN(e)||l(e)};return(0,a.jsx)(s.Z,{trigger:["click"],dropdownRender:()=>(0,a.jsx)("div",{className:"flex h-28 bg-white dark:bg-[rgba(255,255,255,0.5)] items-center justify-center rounded-xl py-3",children:(0,a.jsx)(r.Z,{defaultValue:.5,max:1,min:0,step:.1,vertical:!0,onChange:t,value:e})}),placement:"top",children:(0,a.jsxs)("div",{className:"flex items-center justify-between border rounded-xl bg-white dark:bg-black w-14 p-2 flex-shrink-0",children:[(0,a.jsx)(n.Z,{type:"icon-icons-temperature",className:"text-sm"}),(0,a.jsx)("span",{className:"text-xs font-medium",children:e})]})})}},23820:function(e,l,t){"use strict";t.r(l),t.d(l,{MobileChatContext:function(){return v},default:function(){return b}});var a=t(85893),n=t(41468),s=t(60778),r=t(25519),i=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(r.C9))&&void 0!==e?e:"")},c=t(62418),o=t(1375),d=t(65654),u=t(74330),m=t(5152),x=t.n(m),h=t(39332),p=t(67294),f=t(56397),j=t(74638),g=t(83454);let _=x()(()=>Promise.all([t.e(3662),t.e(1265),t.e(7034),t.e(4567),t.e(2398),t.e(1004),t.e(5265),t.e(7426),t.e(3627),t.e(4866),t.e(9685),t.e(5789),t.e(2925)]).then(t.bind(t,36818)),{loadableGenerated:{webpack:()=>[36818]},ssr:!1}),v=(0,p.createContext)({model:"",temperature:.5,resource:null,setModel:()=>{},setTemperature:()=>{},setResource:()=>{},scene:"",history:[],setHistory:()=>{},scrollViewRef:{current:null},appInfo:{},conv_uid:"",resourceList:[],order:{current:1},handleChat:()=>Promise.resolve(),canAbort:!1,setCarAbort:()=>{},canNewChat:!1,setCanNewChat:()=>{},ctrl:{current:void 0},userInput:"",setUserInput:()=>{},getChatHistoryRun:()=>{}});var b=()=>{var e,l;let t=(0,h.useSearchParams)(),m=null!==(e=null==t?void 0:t.get("chat_scene"))&&void 0!==e?e:"",x=null!==(l=null==t?void 0:t.get("app_code"))&&void 0!==l?l:"",{modelList:b}=(0,p.useContext)(n.p),[y,Z]=(0,p.useState)([]),[N,w]=(0,p.useState)(""),[k,C]=(0,p.useState)(.5),[S,I]=(0,p.useState)(null),T=(0,p.useRef)(null),[P,E]=(0,p.useState)(""),[F,q]=(0,p.useState)(!1),[U,R]=(0,p.useState)(!0),D=(0,p.useRef)(),A=(0,p.useRef)(1),O=i(),V=(0,p.useMemo)(()=>"".concat(null==O?void 0:O.user_no,"_").concat(x),[x,O]),{run:L,loading:M}=(0,d.Z)(async()=>await (0,s.Vx)((0,s.$i)("".concat(null==O?void 0:O.user_no,"_").concat(x))),{manual:!0,onSuccess:e=>{let[,l]=e,t=null==l?void 0:l.filter(e=>"view"===e.role);t&&t.length>0&&(A.current=t[t.length-1].order+1),Z(l||[])}}),{data:z,run:G,loading:H}=(0,d.Z)(async e=>{let[,l]=await (0,s.Vx)((0,s.BN)(e));return null!=l?l:{}},{manual:!0}),{run:Y,data:$,loading:J}=(0,d.Z)(async()=>{var e,l;let[,t]=await (0,s.Vx)((0,s.vD)(m));return I((null==t?void 0:null===(e=t[0])||void 0===e?void 0:e.space_id)||(null==t?void 0:null===(l=t[0])||void 0===l?void 0:l.param)),null!=t?t:[]},{manual:!0}),{run:W,loading:B}=(0,d.Z)(async()=>{let[,e]=await (0,s.Vx)((0,s.iP)());return null!=e?e:[]},{manual:!0,onSuccess:e=>{var l;let t=null===(l=null==e?void 0:e.filter(e=>e.conv_uid===V))||void 0===l?void 0:l[0];(null==t?void 0:t.select_param)&&I(JSON.parse(null==t?void 0:t.select_param))}});(0,p.useEffect)(()=>{m&&x&&b.length&&G({chat_scene:m,app_code:x})},[x,m,G,b]),(0,p.useEffect)(()=>{x&&L()},[x]),(0,p.useEffect)(()=>{if(b.length>0){var e,l,t;let a=null===(e=null==z?void 0:null===(l=z.param_need)||void 0===l?void 0:l.filter(e=>"model"===e.type))||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.value;w(a||b[0])}},[b,z]),(0,p.useEffect)(()=>{var e,l,t;let a=null===(e=null==z?void 0:null===(l=z.param_need)||void 0===l?void 0:l.filter(e=>"temperature"===e.type))||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.value;C(a||.5)},[z]),(0,p.useEffect)(()=>{if(m&&(null==z?void 0:z.app_code)){var e,l,t,a,n,s;let r=null===(e=null==z?void 0:null===(l=z.param_need)||void 0===l?void 0:l.filter(e=>"resource"===e.type))||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.value,i=null===(a=null==z?void 0:null===(n=z.param_need)||void 0===n?void 0:n.filter(e=>"resource"===e.type))||void 0===a?void 0:null===(s=a[0])||void 0===s?void 0:s.bind_value;i&&I(i),["database","knowledge","plugin","awel_flow"].includes(r)&&!i&&Y()}},[z,m,Y]);let K=async e=>{var l,t,a;E(""),D.current=new AbortController;let n={chat_mode:m,model_name:N,user_input:e||P,conv_uid:V,temperature:k,app_code:null==z?void 0:z.app_code,...S&&{select_param:S}};if(y&&y.length>0){let e=null==y?void 0:y.filter(e=>"view"===e.role);A.current=e[e.length-1].order+1}let s=[{role:"human",context:e||P,model_name:N,order:A.current,time_stamp:0},{role:"view",context:"",model_name:N,order:A.current,time_stamp:0,thinking:!0}],i=s.length-1;Z([...y,...s]),R(!1);try{await (0,o.L)("".concat(null!==(l=g.env.API_BASE_URL)&&void 0!==l?l:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[r.gp]:null!==(t=(0,c.n5)())&&void 0!==t?t:""},signal:D.current.signal,body:JSON.stringify(n),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===o.a)return},onclose(){var e;null===(e=D.current)||void 0===e||e.abort(),R(!0),q(!1)},onerror(e){throw Error(e)},onmessage:e=>{let l=e.data;try{l=JSON.parse(l).vis}catch(e){l.replaceAll("\\n","\n")}"[DONE]"===l?(R(!0),q(!1)):(null==l?void 0:l.startsWith("[ERROR]"))?(s[i].context=null==l?void 0:l.replace("[ERROR]",""),s[i].thinking=!1,Z([...y,...s]),R(!0),q(!1)):(q(!0),s[i].context=l,s[i].thinking=!1,Z([...y,...s]))}})}catch(e){null===(a=D.current)||void 0===a||a.abort(),s[i].context="Sorry, we meet some error, please try again later.",s[i].thinking=!1,Z([...s]),R(!0),q(!1)}};return(0,p.useEffect)(()=>{m&&"chat_agent"!==m&&W()},[m,W]),(0,a.jsx)(v.Provider,{value:{model:N,resource:S,setModel:w,setTemperature:C,setResource:I,temperature:k,appInfo:z,conv_uid:V,scene:m,history:y,scrollViewRef:T,setHistory:Z,resourceList:$,order:A,handleChat:K,setCanNewChat:R,ctrl:D,canAbort:F,setCarAbort:q,canNewChat:U,userInput:P,setUserInput:E,getChatHistoryRun:L},children:(0,a.jsx)(u.Z,{size:"large",className:"flex h-screen w-screen justify-center items-center max-h-screen",spinning:M||H||J||B,children:(0,a.jsxs)("div",{className:"flex flex-col h-screen bg-gradient-light dark:bg-gradient-dark p-4 pt-0",children:[(0,a.jsxs)("div",{ref:T,className:"flex flex-col flex-1 overflow-y-auto mb-3",children:[(0,a.jsx)(f.default,{}),(0,a.jsx)(_,{})]}),(null==z?void 0:z.app_code)&&(0,a.jsx)(j.default,{})]})})})}}},function(e){e.O(0,[3662,1265,7034,1449,8289,3791,5217,4330,8791,5593,3886,4435,6877,8591,9859,4567,2398,1004,5265,7426,3627,4866,9685,4627,9656,6520,5789,9774,2888,179],function(){return e(e.s=45629)}),_N_E=e.O()}]);